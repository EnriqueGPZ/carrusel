import{j as i,r as P,R as Un,c as ai}from"./vendor-728d59c3.js";import{f as W}from"./fabric-eee87af9.js";import{J as ii,F as Hn}from"./file-utils-21152769.js";import{c as Rs,i as Is}from"./icons-afed4ae4.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();const Se=1080,ve=1350,J=40,xe="#d4d4d8",oi=[{id:"1-photo",label:"Simple",icon:i.jsx("div",{className:"w-8 h-10 border border-zinc-500 bg-zinc-800 p-1 flex items-center justify-center",children:i.jsx("div",{className:"w-full h-full bg-zinc-500"})})},{id:"2-photos",label:"Doble",icon:i.jsxs("div",{className:"w-8 h-10 border border-zinc-500 bg-zinc-800 p-0.5 flex flex-col gap-0.5",children:[i.jsx("div",{className:"w-full h-1/2 bg-zinc-500"}),i.jsx("div",{className:"w-full h-1/2 bg-zinc-500"})]})},{id:"two-photos-split",label:"Dividida",icon:i.jsxs("div",{className:"w-8 h-10 border border-zinc-500 bg-zinc-800 p-0.5 flex flex-col gap-0.5",children:[i.jsx("div",{className:"w-full h-1/2 bg-zinc-500"}),i.jsxs("div",{className:"w-full h-1/2 flex items-center justify-center relative",children:[i.jsx("div",{className:"w-[80%] h-[80%] bg-white absolute"}),i.jsx("div",{className:"w-[70%] h-[70%] bg-zinc-500 z-10"})]})]})},{id:"4-photos-grid",label:"CuÃ¡druple",icon:i.jsxs("div",{className:"w-8 h-10 border border-zinc-500 bg-zinc-800 p-0.5 grid grid-cols-2 gap-0.5",children:[i.jsx("div",{className:"bg-zinc-500"}),i.jsx("div",{className:"bg-zinc-500"}),i.jsx("div",{className:"bg-zinc-500"}),i.jsx("div",{className:"bg-zinc-500"})]})}],li=(n,e,{view:t,containerWidth:s,containerHeight:r})=>{if(!n)return;const a=-t.x/t.zoom+s/t.zoom/2,c=-t.y/t.zoom+r/t.zoom/2,d=a-Se/2,m=c-ve/2,g=[new W.fabric.Rect({left:d,top:m,width:Se,height:ve,fill:"#ffffff",stroke:"#e4e4e7",strokeWidth:1,selectable:!0,name:"template_bg"})];switch(e){case"1-photo":{const _=Se-J*2,x=ve-J*2;g.push(new W.fabric.Rect({left:d+J,top:m+J,width:_,height:x,fill:xe,selectable:!0}));break}case"2-photos":{const x=(ve-J*3)/2,S=Se-J*2;g.push(new W.fabric.Rect({left:d+J,top:m+J,width:S,height:x,fill:xe,selectable:!0})),g.push(new W.fabric.Rect({left:d+J,top:m+J+x+J,width:S,height:x,fill:xe,selectable:!0}));break}case"two-photos-split":{g.push(new W.fabric.Rect({left:d,top:m,width:Se,height:ve/2,fill:xe,selectable:!0}));const _=Se-J*2,x=ve/2-J*2,S=m+ve/2+J,k=d+J;g.push(new W.fabric.Rect({left:k,top:S,width:_,height:x,fill:"#FFFFFF",selectable:!0}));const A=25;g.push(new W.fabric.Rect({left:k+A,top:S+A,width:_-A*2,height:x-A*2,fill:xe,selectable:!0}));break}case"4-photos-grid":{const _=(Se-J*3)/2,x=(ve-J*3)/2;g.push(new W.fabric.Rect({left:d+J,top:m+J,width:_,height:x,fill:xe,selectable:!0})),g.push(new W.fabric.Rect({left:d+J*2+_,top:m+J,width:_,height:x,fill:xe,selectable:!0})),g.push(new W.fabric.Rect({left:d+J,top:m+J*2+x,width:_,height:x,fill:xe,selectable:!0})),g.push(new W.fabric.Rect({left:d+J*2+_,top:m+J*2+x,width:_,height:x,fill:xe,selectable:!0}));break}default:console.warn("Tipo de plantilla no reconocido:",e)}n.discardActiveObject(),g.forEach(_=>n.add(_));const b=new W.fabric.ActiveSelection(g,{canvas:n});n.setActiveObject(b),n.requestRenderAll()};function T(n,e,t,s,r){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?r.call(n,t):r?r.value=t:e.set(n,t),t}function f(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)}let Xn=function(){const{crypto:n}=globalThis;if(n!=null&&n.randomUUID)return Xn=n.randomUUID.bind(n),n.randomUUID();const e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,s=>(+s^t()&15>>+s/4).toString(16))};function ps(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}const gs=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){const e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};class O extends Error{}class ae extends O{constructor(e,t,s,r){super(`${ae.makeMessage(e,t,s)}`),this.status=e,this.headers=r,this.requestID=r==null?void 0:r.get("x-request-id"),this.error=t;const a=t;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,s){const r=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,s,r){if(!e||!r)return new Xt({message:s,cause:gs(t)});const a=t==null?void 0:t.error;return e===400?new Jn(e,a,s,r):e===401?new Gn(e,a,s,r):e===403?new Kn(e,a,s,r):e===404?new Yn(e,a,s,r):e===409?new Qn(e,a,s,r):e===422?new Zn(e,a,s,r):e===429?new Vn(e,a,s,r):e>=500?new er(e,a,s,r):new ae(e,a,s,r)}}class ue extends ae{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Xt extends ae{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class Es extends Xt{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Jn extends ae{}class Gn extends ae{}class Kn extends ae{}class Yn extends ae{}class Qn extends ae{}class Zn extends ae{}class Vn extends ae{}class er extends ae{}class tr extends O{constructor(){super("Could not parse response content as the length limit was reached")}}class sr extends O{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class et extends Error{constructor(e){super(e)}}const ci=/^[a-z][a-z0-9+.-]*:/i,di=n=>ci.test(n);let oe=n=>(oe=Array.isArray,oe(n)),mn=oe;function nr(n){return typeof n!="object"?{}:n??{}}function ui(n){if(!n)return!0;for(const e in n)return!1;return!0}function hi(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function is(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}const fi=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new O(`${n} must be an integer`);if(e<0)throw new O(`${n} must be a positive integer`);return e},mi=n=>{try{return JSON.parse(n)}catch{return}},ft=n=>new Promise(e=>setTimeout(e,n)),Fe="6.14.0",pi=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function gi(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const bi=()=>{var t;const n=gi();if(n==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Fe,"X-Stainless-OS":gn(Deno.build.os),"X-Stainless-Arch":pn(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Fe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(n==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Fe,"X-Stainless-OS":gn(globalThis.process.platform??"unknown"),"X-Stainless-Arch":pn(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=xi();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Fe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Fe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function xi(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const s=t.exec(navigator.userAgent);if(s){const r=s[1]||0,a=s[2]||0,c=s[3]||0;return{browser:e,version:`${r}.${a}.${c}`}}}return null}const pn=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",gn=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let bn;const wi=()=>bn??(bn=bi());function yi(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function rr(...n){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function ar(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return rr({start(){},async pull(t){const{done:s,value:r}=await e.next();s?t.close():t.enqueue(r)},async cancel(){var t;await((t=e.return)==null?void 0:t.call(e))}})}function ir(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function _i(n){var s,r;if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await((r=(s=n[Symbol.asyncIterator]()).return)==null?void 0:r.call(s));return}const e=n.getReader(),t=e.cancel();e.releaseLock(),await t}const vi=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)}),or="RFC3986",lr=n=>String(n),xn={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:lr},ji="RFC1738";let bs=(n,e)=>(bs=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),bs(n,e));const pe=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),os=1024,Ni=(n,e,t,s,r)=>{if(n.length===0)return n;let a=n;if(typeof n=="symbol"?a=Symbol.prototype.toString.call(n):typeof n!="string"&&(a=String(n)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(d){return"%26%23"+parseInt(d.slice(2),16)+"%3B"});let c="";for(let d=0;d<a.length;d+=os){const m=a.length>=os?a.slice(d,d+os):a,p=[];for(let g=0;g<m.length;++g){let b=m.charCodeAt(g);if(b===45||b===46||b===95||b===126||b>=48&&b<=57||b>=65&&b<=90||b>=97&&b<=122||r===ji&&(b===40||b===41)){p[p.length]=m.charAt(g);continue}if(b<128){p[p.length]=pe[b];continue}if(b<2048){p[p.length]=pe[192|b>>6]+pe[128|b&63];continue}if(b<55296||b>=57344){p[p.length]=pe[224|b>>12]+pe[128|b>>6&63]+pe[128|b&63];continue}g+=1,b=65536+((b&1023)<<10|m.charCodeAt(g)&1023),p[p.length]=pe[240|b>>18]+pe[128|b>>12&63]+pe[128|b>>6&63]+pe[128|b&63]}c+=p.join("")}return c};function Si(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function wn(n,e){if(oe(n)){const t=[];for(let s=0;s<n.length;s+=1)t.push(e(n[s]));return t}return e(n)}const cr={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},dr=function(n,e){Array.prototype.push.apply(n,oe(e)?e:[e])};let yn;const ee={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Ni,encodeValuesOnly:!1,format:or,formatter:lr,indices:!1,serializeDate(n){return(yn??(yn=Function.prototype.call.bind(Date.prototype.toISOString)))(n)},skipNulls:!1,strictNullHandling:!1};function Ai(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const ls={};function ur(n,e,t,s,r,a,c,d,m,p,g,b,_,x,S,k,A,K){let I=n,$=K,E=0,D=!1;for(;($=$.get(ls))!==void 0&&!D;){const X=$.get(n);if(E+=1,typeof X<"u"){if(X===E)throw new RangeError("Cyclic object value");D=!0}typeof $.get(ls)>"u"&&(E=0)}if(typeof p=="function"?I=p(e,I):I instanceof Date?I=_==null?void 0:_(I):t==="comma"&&oe(I)&&(I=wn(I,function(X){return X instanceof Date?_==null?void 0:_(X):X})),I===null){if(a)return m&&!k?m(e,ee.encoder,A,"key",x):e;I=""}if(Ai(I)||Si(I)){if(m){const X=k?e:m(e,ee.encoder,A,"key",x);return[(S==null?void 0:S(X))+"="+(S==null?void 0:S(m(I,ee.encoder,A,"value",x)))]}return[(S==null?void 0:S(e))+"="+(S==null?void 0:S(String(I)))]}const L=[];if(typeof I>"u")return L;let v;if(t==="comma"&&oe(I))k&&m&&(I=wn(I,m)),v=[{value:I.length>0?I.join(",")||null:void 0}];else if(oe(p))v=p;else{const X=Object.keys(I);v=g?X.sort(g):X}const H=d?String(e).replace(/\./g,"%2E"):String(e),U=s&&oe(I)&&I.length===1?H+"[]":H;if(r&&oe(I)&&I.length===0)return U+"[]";for(let X=0;X<v.length;++X){const B=v[X],_e=typeof B=="object"&&typeof B.value<"u"?B.value:I[B];if(c&&_e===null)continue;const qe=b&&d?B.replace(/\./g,"%2E"):B,Ue=oe(I)?typeof t=="function"?t(U,qe):U:U+(b?"."+qe:"["+qe+"]");K.set(n,E);const He=new WeakMap;He.set(ls,K),dr(L,ur(_e,Ue,t,s,r,a,c,d,t==="comma"&&k&&oe(I)?null:m,p,g,b,_,x,S,k,A,He))}return L}function ki(n=ee){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||ee.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=or;if(typeof n.format<"u"){if(!bs(xn,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const s=xn[t];let r=ee.filter;(typeof n.filter=="function"||oe(n.filter))&&(r=n.filter);let a;if(n.arrayFormat&&n.arrayFormat in cr?a=n.arrayFormat:"indices"in n?a=n.indices?"indices":"repeat":a=ee.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const c=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:ee.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:ee.addQueryPrefix,allowDots:c,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:ee.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:ee.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?ee.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:ee.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:ee.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:ee.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:ee.encodeValuesOnly,filter:r,format:t,formatter:s,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:ee.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:ee.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:ee.strictNullHandling}}function Ci(n,e={}){let t=n;const s=ki(e);let r,a;typeof s.filter=="function"?(a=s.filter,t=a("",t)):oe(s.filter)&&(a=s.filter,r=a);const c=[];if(typeof t!="object"||t===null)return"";const d=cr[s.arrayFormat],m=d==="comma"&&s.commaRoundTrip;r||(r=Object.keys(t)),s.sort&&r.sort(s.sort);const p=new WeakMap;for(let _=0;_<r.length;++_){const x=r[_];s.skipNulls&&t[x]===null||dr(c,ur(t[x],x,d,m,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,p))}const g=c.join(s.delimiter);let b=s.addQueryPrefix===!0?"?":"";return s.charsetSentinel&&(s.charset==="iso-8859-1"?b+="utf8=%26%2310003%3B&":b+="utf8=%E2%9C%93&"),g.length>0?b+g:""}function Ri(n){let e=0;for(const r of n)e+=r.length;const t=new Uint8Array(e);let s=0;for(const r of n)t.set(r,s),s+=r.length;return t}let _n;function Os(n){let e;return(_n??(e=new globalThis.TextEncoder,_n=e.encode.bind(e)))(n)}let vn;function jn(n){let e;return(vn??(e=new globalThis.TextDecoder,vn=e.decode.bind(e)))(n)}var le,ce;class Jt{constructor(){le.set(this,void 0),ce.set(this,void 0),T(this,le,new Uint8Array,"f"),T(this,ce,null,"f")}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Os(e):e;T(this,le,Ri([f(this,le,"f"),t]),"f");const s=[];let r;for(;(r=Ii(f(this,le,"f"),f(this,ce,"f")))!=null;){if(r.carriage&&f(this,ce,"f")==null){T(this,ce,r.index,"f");continue}if(f(this,ce,"f")!=null&&(r.index!==f(this,ce,"f")+1||r.carriage)){s.push(jn(f(this,le,"f").subarray(0,f(this,ce,"f")-1))),T(this,le,f(this,le,"f").subarray(f(this,ce,"f")),"f"),T(this,ce,null,"f");continue}const a=f(this,ce,"f")!==null?r.preceding-1:r.preceding,c=jn(f(this,le,"f").subarray(0,a));s.push(c),T(this,le,f(this,le,"f").subarray(r.index),"f"),T(this,ce,null,"f")}return s}flush(){return f(this,le,"f").length?this.decode(`
`):[]}}le=new WeakMap,ce=new WeakMap;Jt.NEWLINE_CHARS=new Set([`
`,"\r"]);Jt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Ii(n,e){for(let r=e??0;r<n.length;r++){if(n[r]===10)return{preceding:r,index:r+1,carriage:!1};if(n[r]===13)return{preceding:r,index:r+1,carriage:!0}}return null}function Ei(n){for(let s=0;s<n.length-1;s++){if(n[s]===10&&n[s+1]===10||n[s]===13&&n[s+1]===13)return s+2;if(n[s]===13&&n[s+1]===10&&s+3<n.length&&n[s+2]===13&&n[s+3]===10)return s+4}return-1}const Ft={off:0,error:200,warn:300,info:400,debug:500},Nn=(n,e,t)=>{if(n){if(hi(Ft,n))return n;ne(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(Ft))}`)}};function tt(){}function _t(n,e,t){return!e||Ft[n]>Ft[t]?tt:e[n].bind(e)}const Oi={error:tt,warn:tt,info:tt,debug:tt};let Sn=new WeakMap;function ne(n){const e=n.logger,t=n.logLevel??"off";if(!e)return Oi;const s=Sn.get(e);if(s&&s[0]===t)return s[1];const r={error:_t("error",e,t),warn:_t("warn",e,t),info:_t("info",e,t),debug:_t("debug",e,t)};return Sn.set(e,[t,r]),r}const Ae=n=>(n.options&&(n.options={...n.options},delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);var Ze;class be{constructor(e,t,s){this.iterator=e,Ze.set(this,void 0),this.controller=t,T(this,Ze,s,"f")}static fromSSEResponse(e,t,s){let r=!1;const a=s?ne(s):console;async function*c(){if(r)throw new O("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let d=!1;try{for await(const m of Pi(e,t))if(!d){if(m.data.startsWith("[DONE]")){d=!0;continue}if(m.event===null||!m.event.startsWith("thread.")){let p;try{p=JSON.parse(m.data)}catch(g){throw a.error("Could not parse message into JSON:",m.data),a.error("From chunk:",m.raw),g}if(p&&p.error)throw new ae(void 0,p.error,void 0,e.headers);yield p}else{let p;try{p=JSON.parse(m.data)}catch(g){throw console.error("Could not parse message into JSON:",m.data),console.error("From chunk:",m.raw),g}if(m.event=="error")throw new ae(void 0,p.error,p.message,void 0);yield{event:m.event,data:p}}}d=!0}catch(m){if(ps(m))return;throw m}finally{d||t.abort()}}return new be(c,t,s)}static fromReadableStream(e,t,s){let r=!1;async function*a(){const d=new Jt,m=ir(e);for await(const p of m)for(const g of d.decode(p))yield g;for(const p of d.flush())yield p}async function*c(){if(r)throw new O("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let d=!1;try{for await(const m of a())d||m&&(yield JSON.parse(m));d=!0}catch(m){if(ps(m))return;throw m}finally{d||t.abort()}}return new be(c,t,s)}[(Ze=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),r=a=>({next:()=>{if(a.length===0){const c=s.next();e.push(c),t.push(c)}return a.shift()}});return[new be(()=>r(e),this.controller,f(this,Ze,"f")),new be(()=>r(t),this.controller,f(this,Ze,"f"))]}toReadableStream(){const e=this;let t;return rr({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:r,done:a}=await t.next();if(a)return s.close();const c=Os(JSON.stringify(r)+`
`);s.enqueue(c)}catch(r){s.error(r)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*Pi(n,e){if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new O("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new O("Attempted to iterate over a response with no body");const t=new Mi,s=new Jt,r=ir(n.body);for await(const a of $i(r))for(const c of s.decode(a)){const d=t.decode(c);d&&(yield d)}for(const a of s.flush()){const c=t.decode(a);c&&(yield c)}}async function*$i(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const s=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?Os(t):t;let r=new Uint8Array(e.length+s.length);r.set(e),r.set(s,e.length),e=r;let a;for(;(a=Ei(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class Mi{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,r]=Ti(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}}function Ti(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}async function hr(n,e){const{response:t,requestLogID:s,retryOfRequestLogID:r,startTime:a}=e,c=await(async()=>{var b;if(e.options.stream)return ne(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,n):be.fromSSEResponse(t,e.controller,n);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const d=t.headers.get("content-type"),m=(b=d==null?void 0:d.split(";")[0])==null?void 0:b.trim();if((m==null?void 0:m.includes("application/json"))||(m==null?void 0:m.endsWith("+json"))){const _=await t.json();return fr(_,t)}return await t.text()})();return ne(n).debug(`[${s}] response parsed`,Ae({retryOfRequestLogID:r,url:t.url,status:t.status,body:c,durationMs:Date.now()-a})),c}function fr(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var st;class Gt extends Promise{constructor(e,t,s=hr){super(r=>{r(null)}),this.responsePromise=t,this.parseResponse=s,st.set(this,void 0),T(this,st,e,"f")}_thenUnwrap(e){return new Gt(f(this,st,"f"),this.responsePromise,async(t,s)=>fr(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(f(this,st,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}st=new WeakMap;var vt;class Ps{constructor(e,t,s,r){vt.set(this,void 0),T(this,vt,e,"f"),this.options=r,this.response=t,this.body=s}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new O("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await f(this,vt,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(vt=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Fi extends Gt{constructor(e,t,s){super(e,t,async(r,a)=>new s(r,a.response,await hr(r,a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}class Kt extends Ps{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class Q extends Ps{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var s;const e=this.getPaginatedItems(),t=(s=e[e.length-1])==null?void 0:s.id;return t?{...this.options,query:{...nr(this.options.query),after:t}}:null}}class zt extends Ps{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1,this.last_id=s.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const e=this.last_id;return e?{...this.options,query:{...nr(this.options.query),after:e}}:null}}const mr=()=>{var n;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((n=e==null?void 0:e.versions)==null?void 0:n.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function ct(n,e,t){return mr(),new File(n,e??"unknown_file",t)}function Ct(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}const $s=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",An=async(n,e)=>xs(n.body)?{...n,body:await pr(n.body,e)}:n,Ie=async(n,e)=>({...n,body:await pr(n.body,e)}),kn=new WeakMap;function zi(n){const e=typeof n=="function"?n:n.fetch,t=kn.get(e);if(t)return t;const s=(async()=>{try{const r="Response"in e?e.Response:(await e("data:,")).constructor,a=new FormData;return a.toString()!==await new r(a).text()}catch{return!0}})();return kn.set(e,s),s}const pr=async(n,e)=>{if(!await zi(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(n||{}).map(([s,r])=>ws(t,s,r))),t},gr=n=>n instanceof Blob&&"name"in n,Li=n=>typeof n=="object"&&n!==null&&(n instanceof Response||$s(n)||gr(n)),xs=n=>{if(Li(n))return!0;if(Array.isArray(n))return n.some(xs);if(n&&typeof n=="object"){for(const e in n)if(xs(n[e]))return!0}return!1},ws=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(t instanceof Response)n.append(e,ct([await t.blob()],Ct(t)));else if($s(t))n.append(e,ct([await new Response(ar(t)).blob()],Ct(t)));else if(gr(t))n.append(e,t,Ct(t));else if(Array.isArray(t))await Promise.all(t.map(s=>ws(n,e+"[]",s)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([s,r])=>ws(n,`${e}[${s}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},br=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",Di=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&br(n),Bi=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function Wi(n,e,t){if(mr(),n=await n,Di(n))return n instanceof File?n:ct([await n.arrayBuffer()],n.name);if(Bi(n)){const r=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),ct(await ys(r),e,t)}const s=await ys(n);if(e||(e=Ct(n)),!(t!=null&&t.type)){const r=s.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof r=="string"&&(t={...t,type:r})}return ct(s,e,t)}async function ys(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(br(n))e.push(n instanceof Blob?n:await n.arrayBuffer());else if($s(n))for await(const s of n)e.push(...await ys(s));else{const s=(t=n==null?void 0:n.constructor)==null?void 0:t.name;throw new Error(`Unexpected data type: ${typeof n}${s?`; constructor: ${s}`:""}${qi(n)}`)}return e}function qi(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}class R{constructor(e){this._client=e}}function xr(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Cn=Object.freeze(Object.create(null)),Ui=(n=xr)=>function(t,...s){if(t.length===1)return t[0];let r=!1;const a=[],c=t.reduce((g,b,_)=>{var k;/[?#]/.test(b)&&(r=!0);const x=s[_];let S=(r?encodeURIComponent:n)(""+x);return _!==s.length&&(x==null||typeof x=="object"&&x.toString===((k=Object.getPrototypeOf(Object.getPrototypeOf(x.hasOwnProperty??Cn)??Cn))==null?void 0:k.toString))&&(S=x+"",a.push({start:g.length+b.length,length:S.length,error:`Value of type ${Object.prototype.toString.call(x).slice(8,-1)} is not a valid path parameter`})),g+b+(_===s.length?"":S)},""),d=c.split(/[?#]/,1)[0],m=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let p;for(;(p=m.exec(d))!==null;)a.push({start:p.index,length:p[0].length,error:`Value "${p[0]}" can't be safely passed as a path parameter`});if(a.sort((g,b)=>g.start-b.start),a.length>0){let g=0;const b=a.reduce((_,x)=>{const S=" ".repeat(x.start-g),k="^".repeat(x.length);return g=x.start+x.length,_+S+k},"");throw new O(`Path parameters result in path with invalid segments:
${a.map(_=>_.error).join(`
`)}
${c}
${b}`)}return c},y=Ui(xr);let wr=class extends R{list(e,t={},s){return this._client.getAPIList(y`/chat/completions/${e}/messages`,Q,{query:t,...s})}};function Lt(n){return n!==void 0&&"function"in n&&n.function!==void 0}function Ms(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function mt(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function Hi(n,e){return!e||!yr(e)?{...n,choices:n.choices.map(t=>(_r(t.message.tool_calls),{...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Ts(n,e)}function Ts(n,e){const t=n.choices.map(s=>{var r;if(s.finish_reason==="length")throw new tr;if(s.finish_reason==="content_filter")throw new sr;return _r(s.message.tool_calls),{...s,message:{...s.message,...s.message.tool_calls?{tool_calls:((r=s.message.tool_calls)==null?void 0:r.map(a=>Ji(e,a)))??void 0}:void 0,parsed:s.message.content&&!s.message.refusal?Xi(e,s.message.content):null}}});return{...n,choices:t}}function Xi(n,e){var t,s;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((s=n.response_format)==null?void 0:s.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function Ji(n,e){var s;const t=(s=n.tools)==null?void 0:s.find(r=>{var a;return Lt(r)&&((a=r.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:mt(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function Gi(n,e){var s;if(!n||!("tools"in n)||!n.tools)return!1;const t=(s=n.tools)==null?void 0:s.find(r=>{var a;return Lt(r)&&((a=r.function)==null?void 0:a.name)===e.function.name});return Lt(t)&&(mt(t)||(t==null?void 0:t.function.strict)||!1)}function yr(n){var e;return Ms(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>mt(t)||t.type==="function"&&t.function.strict===!0))??!1}function _r(n){for(const e of n||[])if(e.type!=="function")throw new O(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}function Ki(n){for(const e of n??[]){if(e.type!=="function")throw new O(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new O(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}const Dt=n=>(n==null?void 0:n.role)==="assistant",vr=n=>(n==null?void 0:n.role)==="tool";var _s,Rt,It,nt,rt,Et,at,ye,it,Bt,Wt,ze,jr;class Fs{constructor(){_s.add(this),this.controller=new AbortController,Rt.set(this,void 0),It.set(this,()=>{}),nt.set(this,()=>{}),rt.set(this,void 0),Et.set(this,()=>{}),at.set(this,()=>{}),ye.set(this,{}),it.set(this,!1),Bt.set(this,!1),Wt.set(this,!1),ze.set(this,!1),T(this,Rt,new Promise((e,t)=>{T(this,It,e,"f"),T(this,nt,t,"f")}),"f"),T(this,rt,new Promise((e,t)=>{T(this,Et,e,"f"),T(this,at,t,"f")}),"f"),f(this,Rt,"f").catch(()=>{}),f(this,rt,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},f(this,_s,"m",jr).bind(this))},0)}_connected(){this.ended||(f(this,It,"f").call(this),this._emit("connect"))}get ended(){return f(this,it,"f")}get errored(){return f(this,Bt,"f")}get aborted(){return f(this,Wt,"f")}abort(){this.controller.abort()}on(e,t){return(f(this,ye,"f")[e]||(f(this,ye,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=f(this,ye,"f")[e];if(!s)return this;const r=s.findIndex(a=>a.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(f(this,ye,"f")[e]||(f(this,ye,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{T(this,ze,!0,"f"),e!=="error"&&this.once("error",s),this.once(e,t)})}async done(){T(this,ze,!0,"f"),await f(this,rt,"f")}_emit(e,...t){if(f(this,it,"f"))return;e==="end"&&(T(this,it,!0,"f"),f(this,Et,"f").call(this));const s=f(this,ye,"f")[e];if(s&&(f(this,ye,"f")[e]=s.filter(r=>!r.once),s.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!f(this,ze,"f")&&!(s!=null&&s.length)&&Promise.reject(r),f(this,nt,"f").call(this,r),f(this,at,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!f(this,ze,"f")&&!(s!=null&&s.length)&&Promise.reject(r),f(this,nt,"f").call(this,r),f(this,at,"f").call(this,r),this._emit("end")}}_emitFinal(){}}Rt=new WeakMap,It=new WeakMap,nt=new WeakMap,rt=new WeakMap,Et=new WeakMap,at=new WeakMap,ye=new WeakMap,it=new WeakMap,Bt=new WeakMap,Wt=new WeakMap,ze=new WeakMap,_s=new WeakSet,jr=function(e){if(T(this,Bt,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new ue),e instanceof ue)return T(this,Wt,!0,"f"),this._emit("abort",e);if(e instanceof O)return this._emit("error",e);if(e instanceof Error){const t=new O(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new O(String(e)))};function Yi(n){return typeof n.parse=="function"}var ie,vs,qt,js,Ns,Ss,Nr,Sr;const Qi=10;class Ar extends Fs{constructor(){super(...arguments),ie.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var s;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(s=e.choices[0])==null?void 0:s.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),vr(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(Dt(e)&&e.tool_calls)for(const s of e.tool_calls)s.type==="function"&&this._emit("functionToolCall",s.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new O("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),f(this,ie,"m",vs).call(this)}async finalMessage(){return await this.done(),f(this,ie,"m",qt).call(this)}async finalFunctionToolCall(){return await this.done(),f(this,ie,"m",js).call(this)}async finalFunctionToolCallResult(){return await this.done(),f(this,ie,"m",Ns).call(this)}async totalUsage(){return await this.done(),f(this,ie,"m",Ss).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=f(this,ie,"m",qt).call(this);t&&this._emit("finalMessage",t);const s=f(this,ie,"m",vs).call(this);s&&this._emit("finalContent",s);const r=f(this,ie,"m",js).call(this);r&&this._emit("finalFunctionToolCall",r);const a=f(this,ie,"m",Ns).call(this);a!=null&&this._emit("finalFunctionToolCallResult",a),this._chatCompletions.some(c=>c.usage)&&this._emit("totalUsage",f(this,ie,"m",Ss).call(this))}async _createChatCompletion(e,t,s){const r=s==null?void 0:s.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),f(this,ie,"m",Nr).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Ts(a,t))}async _runChatCompletion(e,t,s){for(const r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){var x,S,k;const r="tool",{tool_choice:a="auto",stream:c,...d}=t,m=typeof a!="string"&&a.type==="function"&&((x=a==null?void 0:a.function)==null?void 0:x.name),{maxChatCompletions:p=Qi}=s||{},g=t.tools.map(A=>{if(mt(A)){if(!A.$callback)throw new O("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:A.$callback,name:A.function.name,description:A.function.description||"",parameters:A.function.parameters,parse:A.$parseRaw,strict:!0}}}return A}),b={};for(const A of g)A.type==="function"&&(b[A.function.name||A.function.function.name]=A.function);const _="tools"in t?g.map(A=>A.type==="function"?{type:"function",function:{name:A.function.name||A.function.function.name,parameters:A.function.parameters,description:A.function.description,strict:A.function.strict}}:A):void 0;for(const A of t.messages)this._addMessage(A,!1);for(let A=0;A<p;++A){const I=(S=(await this._createChatCompletion(e,{...d,tool_choice:a,tools:_,messages:[...this.messages]},s)).choices[0])==null?void 0:S.message;if(!I)throw new O("missing message in ChatCompletion response");if(!((k=I.tool_calls)!=null&&k.length))return;for(const $ of I.tool_calls){if($.type!=="function")continue;const E=$.id,{name:D,arguments:L}=$.function,v=b[D];if(v){if(m&&m!==D){const B=`Invalid tool_call: ${JSON.stringify(D)}. ${JSON.stringify(m)} requested. Please try again`;this._addMessage({role:r,tool_call_id:E,content:B});continue}}else{const B=`Invalid tool_call: ${JSON.stringify(D)}. Available options are: ${Object.keys(b).map(_e=>JSON.stringify(_e)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:E,content:B});continue}let H;try{H=Yi(v)?await v.parse(L):L}catch(B){const _e=B instanceof Error?B.message:String(B);this._addMessage({role:r,tool_call_id:E,content:_e});continue}const U=await v.function(H,this),X=f(this,ie,"m",Sr).call(this,U);if(this._addMessage({role:r,tool_call_id:E,content:X}),m)return}}}}ie=new WeakSet,vs=function(){return f(this,ie,"m",qt).call(this).content??null},qt=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Dt(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new O("stream ended without producing a ChatCompletionMessage with role=assistant")},js=function(){var e,t;for(let s=this.messages.length-1;s>=0;s--){const r=this.messages[s];if(Dt(r)&&((e=r==null?void 0:r.tool_calls)!=null&&e.length))return(t=r.tool_calls.filter(a=>a.type==="function").at(-1))==null?void 0:t.function}},Ns=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(vr(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(s=>{var r;return s.role==="assistant"&&((r=s.tool_calls)==null?void 0:r.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},Ss=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Nr=function(e){if(e.n!=null&&e.n>1)throw new O("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Sr=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class zs extends Ar{static runTools(e,t,s){const r=new zs,a={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}_addMessage(e,t=!0){super._addMessage(e,t),Dt(e)&&e.content&&this._emit("content",e.content)}}const kr=1,Cr=2,Rr=4,Ir=8,Er=16,Or=32,Pr=64,$r=128,Mr=256,Tr=$r|Mr,Fr=Er|Or|Tr|Pr,zr=kr|Cr|Fr,Lr=Rr|Ir,Zi=zr|Lr,se={STR:kr,NUM:Cr,ARR:Rr,OBJ:Ir,NULL:Er,BOOL:Or,NAN:Pr,INFINITY:$r,MINUS_INFINITY:Mr,INF:Tr,SPECIAL:Fr,ATOM:zr,COLLECTION:Lr,ALL:Zi};class Vi extends Error{}class eo extends Error{}function to(n,e=se.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return so(n.trim(),e)}const so=(n,e)=>{const t=n.length;let s=0;const r=_=>{throw new Vi(`${_} at position ${s}`)},a=_=>{throw new eo(`${_} at position ${s}`)},c=()=>(b(),s>=t&&r("Unexpected end of input"),n[s]==='"'?d():n[s]==="{"?m():n[s]==="["?p():n.substring(s,s+4)==="null"||se.NULL&e&&t-s<4&&"null".startsWith(n.substring(s))?(s+=4,null):n.substring(s,s+4)==="true"||se.BOOL&e&&t-s<4&&"true".startsWith(n.substring(s))?(s+=4,!0):n.substring(s,s+5)==="false"||se.BOOL&e&&t-s<5&&"false".startsWith(n.substring(s))?(s+=5,!1):n.substring(s,s+8)==="Infinity"||se.INFINITY&e&&t-s<8&&"Infinity".startsWith(n.substring(s))?(s+=8,1/0):n.substring(s,s+9)==="-Infinity"||se.MINUS_INFINITY&e&&1<t-s&&t-s<9&&"-Infinity".startsWith(n.substring(s))?(s+=9,-1/0):n.substring(s,s+3)==="NaN"||se.NAN&e&&t-s<3&&"NaN".startsWith(n.substring(s))?(s+=3,NaN):g()),d=()=>{const _=s;let x=!1;for(s++;s<t&&(n[s]!=='"'||x&&n[s-1]==="\\");)x=n[s]==="\\"?!x:!1,s++;if(n.charAt(s)=='"')try{return JSON.parse(n.substring(_,++s-Number(x)))}catch(S){a(String(S))}else if(se.STR&e)try{return JSON.parse(n.substring(_,s-Number(x))+'"')}catch{return JSON.parse(n.substring(_,n.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},m=()=>{s++,b();const _={};try{for(;n[s]!=="}";){if(b(),s>=t&&se.OBJ&e)return _;const x=d();b(),s++;try{const S=c();Object.defineProperty(_,x,{value:S,writable:!0,enumerable:!0,configurable:!0})}catch(S){if(se.OBJ&e)return _;throw S}b(),n[s]===","&&s++}}catch{if(se.OBJ&e)return _;r("Expected '}' at end of object")}return s++,_},p=()=>{s++;const _=[];try{for(;n[s]!=="]";)_.push(c()),b(),n[s]===","&&s++}catch{if(se.ARR&e)return _;r("Expected ']' at end of array")}return s++,_},g=()=>{if(s===0){n==="-"&&se.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(n)}catch(x){if(se.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}a(String(x))}}const _=s;for(n[s]==="-"&&s++;n[s]&&!",]}".includes(n[s]);)s++;s==t&&!(se.NUM&e)&&r("Unterminated number literal");try{return JSON.parse(n.substring(_,s))}catch{n.substring(_,s)==="-"&&se.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(n.substring(_,n.lastIndexOf("e")))}catch(S){a(String(S))}}},b=()=>{for(;s<t&&` 
\r	`.includes(n[s]);)s++};return c()},Rn=n=>to(n,se.ALL^se.NUM);var Z,we,Oe,je,cs,jt,ds,us,hs,Nt,fs,In;class ht extends Ar{constructor(e){super(),Z.add(this),we.set(this,void 0),Oe.set(this,void 0),je.set(this,void 0),T(this,we,e,"f"),T(this,Oe,[],"f")}get currentChatCompletionSnapshot(){return f(this,je,"f")}static fromReadableStream(e){const t=new ht(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){const r=new ht(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,s){var c;super._createChatCompletion;const r=s==null?void 0:s.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),f(this,Z,"m",cs).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const d of a)f(this,Z,"m",ds).call(this,d);if((c=a.controller.signal)!=null&&c.aborted)throw new ue;return this._addChatCompletion(f(this,Z,"m",Nt).call(this))}async _fromReadableStream(e,t){var c;const s=t==null?void 0:t.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),f(this,Z,"m",cs).call(this),this._connected();const r=be.fromReadableStream(e,this.controller);let a;for await(const d of r)a&&a!==d.id&&this._addChatCompletion(f(this,Z,"m",Nt).call(this)),f(this,Z,"m",ds).call(this,d),a=d.id;if((c=r.controller.signal)!=null&&c.aborted)throw new ue;return this._addChatCompletion(f(this,Z,"m",Nt).call(this))}[(we=new WeakMap,Oe=new WeakMap,je=new WeakMap,Z=new WeakSet,cs=function(){this.ended||T(this,je,void 0,"f")},jt=function(t){let s=f(this,Oe,"f")[t.index];return s||(s={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},f(this,Oe,"f")[t.index]=s,s)},ds=function(t){var r,a,c,d,m,p,g,b,_,x,S,k,A,K,I;if(this.ended)return;const s=f(this,Z,"m",In).call(this,t);this._emit("chunk",t,s);for(const $ of t.choices){const E=s.choices[$.index];$.delta.content!=null&&((r=E.message)==null?void 0:r.role)==="assistant"&&((a=E.message)!=null&&a.content)&&(this._emit("content",$.delta.content,E.message.content),this._emit("content.delta",{delta:$.delta.content,snapshot:E.message.content,parsed:E.message.parsed})),$.delta.refusal!=null&&((c=E.message)==null?void 0:c.role)==="assistant"&&((d=E.message)!=null&&d.refusal)&&this._emit("refusal.delta",{delta:$.delta.refusal,snapshot:E.message.refusal}),((m=$.logprobs)==null?void 0:m.content)!=null&&((p=E.message)==null?void 0:p.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(g=$.logprobs)==null?void 0:g.content,snapshot:((b=E.logprobs)==null?void 0:b.content)??[]}),((_=$.logprobs)==null?void 0:_.refusal)!=null&&((x=E.message)==null?void 0:x.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(S=$.logprobs)==null?void 0:S.refusal,snapshot:((k=E.logprobs)==null?void 0:k.refusal)??[]});const D=f(this,Z,"m",jt).call(this,E);E.finish_reason&&(f(this,Z,"m",hs).call(this,E),D.current_tool_call_index!=null&&f(this,Z,"m",us).call(this,E,D.current_tool_call_index));for(const L of $.delta.tool_calls??[])D.current_tool_call_index!==L.index&&(f(this,Z,"m",hs).call(this,E),D.current_tool_call_index!=null&&f(this,Z,"m",us).call(this,E,D.current_tool_call_index)),D.current_tool_call_index=L.index;for(const L of $.delta.tool_calls??[]){const v=(A=E.message.tool_calls)==null?void 0:A[L.index];v!=null&&v.type&&((v==null?void 0:v.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(K=v.function)==null?void 0:K.name,index:L.index,arguments:v.function.arguments,parsed_arguments:v.function.parsed_arguments,arguments_delta:((I=L.function)==null?void 0:I.arguments)??""}):(v==null||v.type,void 0))}}},us=function(t,s){var c,d,m;if(f(this,Z,"m",jt).call(this,t).done_tool_calls.has(s))return;const a=(c=t.message.tool_calls)==null?void 0:c[s];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const p=(m=(d=f(this,we,"f"))==null?void 0:d.tools)==null?void 0:m.find(g=>Lt(g)&&g.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:s,arguments:a.function.arguments,parsed_arguments:mt(p)?p.$parseRaw(a.function.arguments):p!=null&&p.function.strict?JSON.parse(a.function.arguments):null})}else a.type},hs=function(t){var r,a;const s=f(this,Z,"m",jt).call(this,t);if(t.message.content&&!s.content_done){s.content_done=!0;const c=f(this,Z,"m",fs).call(this);this._emit("content.done",{content:t.message.content,parsed:c?c.$parseRaw(t.message.content):null})}t.message.refusal&&!s.refusal_done&&(s.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(r=t.logprobs)!=null&&r.content&&!s.logprobs_content_done&&(s.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!s.logprobs_refusal_done&&(s.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Nt=function(){if(this.ended)throw new O("stream has ended, this shouldn't happen");const t=f(this,je,"f");if(!t)throw new O("request ended without sending any chunks");return T(this,je,void 0,"f"),T(this,Oe,[],"f"),no(t,f(this,we,"f"))},fs=function(){var s;const t=(s=f(this,we,"f"))==null?void 0:s.response_format;return Ms(t)?t:null},In=function(t){var s,r,a,c;let d=f(this,je,"f");const{choices:m,...p}=t;d?Object.assign(d,p):d=T(this,je,{...p,choices:[]},"f");for(const{delta:g,finish_reason:b,index:_,logprobs:x=null,...S}of t.choices){let k=d.choices[_];if(k||(k=d.choices[_]={finish_reason:b,index:_,message:{},logprobs:x,...S}),x)if(!k.logprobs)k.logprobs=Object.assign({},x);else{const{content:L,refusal:v,...H}=x;Object.assign(k.logprobs,H),L&&((s=k.logprobs).content??(s.content=[]),k.logprobs.content.push(...L)),v&&((r=k.logprobs).refusal??(r.refusal=[]),k.logprobs.refusal.push(...v))}if(b&&(k.finish_reason=b,f(this,we,"f")&&yr(f(this,we,"f")))){if(b==="length")throw new tr;if(b==="content_filter")throw new sr}if(Object.assign(k,S),!g)continue;const{content:A,refusal:K,function_call:I,role:$,tool_calls:E,...D}=g;if(Object.assign(k.message,D),K&&(k.message.refusal=(k.message.refusal||"")+K),$&&(k.message.role=$),I&&(k.message.function_call?(I.name&&(k.message.function_call.name=I.name),I.arguments&&((a=k.message.function_call).arguments??(a.arguments=""),k.message.function_call.arguments+=I.arguments)):k.message.function_call=I),A&&(k.message.content=(k.message.content||"")+A,!k.message.refusal&&f(this,Z,"m",fs).call(this)&&(k.message.parsed=Rn(k.message.content))),E){k.message.tool_calls||(k.message.tool_calls=[]);for(const{index:L,id:v,type:H,function:U,...X}of E){const B=(c=k.message.tool_calls)[L]??(c[L]={});Object.assign(B,X),v&&(B.id=v),H&&(B.type=H),U&&(B.function??(B.function={name:U.name??"",arguments:""})),U!=null&&U.name&&(B.function.name=U.name),U!=null&&U.arguments&&(B.function.arguments+=U.arguments,Gi(f(this,we,"f"),B)&&(B.function.parsed_arguments=Rn(B.function.arguments)))}}}return d},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("chunk",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{s=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{s=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{s=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((a,c)=>t.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new be(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function no(n,e){const{id:t,choices:s,created:r,model:a,system_fingerprint:c,...d}=n,m={...d,id:t,choices:s.map(({message:p,finish_reason:g,index:b,logprobs:_,...x})=>{if(!g)throw new O(`missing finish_reason for choice ${b}`);const{content:S=null,function_call:k,tool_calls:A,...K}=p,I=p.role;if(!I)throw new O(`missing role for choice ${b}`);if(k){const{arguments:$,name:E}=k;if($==null)throw new O(`missing function_call.arguments for choice ${b}`);if(!E)throw new O(`missing function_call.name for choice ${b}`);return{...x,message:{content:S,function_call:{arguments:$,name:E},role:I,refusal:p.refusal??null},finish_reason:g,index:b,logprobs:_}}return A?{...x,index:b,finish_reason:g,logprobs:_,message:{...K,role:I,content:S,refusal:p.refusal??null,tool_calls:A.map(($,E)=>{const{function:D,type:L,id:v,...H}=$,{arguments:U,name:X,...B}=D||{};if(v==null)throw new O(`missing choices[${b}].tool_calls[${E}].id
${St(n)}`);if(L==null)throw new O(`missing choices[${b}].tool_calls[${E}].type
${St(n)}`);if(X==null)throw new O(`missing choices[${b}].tool_calls[${E}].function.name
${St(n)}`);if(U==null)throw new O(`missing choices[${b}].tool_calls[${E}].function.arguments
${St(n)}`);return{...H,id:v,type:L,function:{...B,name:X,arguments:U}}})}}:{...x,message:{...K,content:S,role:I,refusal:p.refusal??null},finish_reason:g,index:b,logprobs:_}}),created:r,model:a,object:"chat.completion",...c?{system_fingerprint:c}:{}};return Hi(m,e)}function St(n){return JSON.stringify(n)}class Ut extends ht{static fromReadableStream(e){const t=new Ut(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,s){const r=new Ut(t),a={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}}let Ls=class extends R{constructor(){super(...arguments),this.messages=new wr(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(y`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(y`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",Q,{query:e,...t})}delete(e,t){return this._client.delete(y`/chat/completions/${e}`,t)}parse(e,t){return Ki(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(s=>Ts(s,e))}runTools(e,t){return e.stream?Ut.runTools(this._client,e,t):zs.runTools(this._client,e,t)}stream(e,t){return ht.createChatCompletion(this._client,e,t)}};Ls.Messages=wr;class Ds extends R{constructor(){super(...arguments),this.completions=new Ls(this._client)}}Ds.Completions=Ls;const Dr=Symbol("brand.privateNullableHeaders");function*ro(n){if(!n)return;if(Dr in n){const{values:s,nulls:r}=n;yield*s.entries();for(const a of r)yield[a,null];return}let e=!1,t;n instanceof Headers?t=n.entries():mn(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let s of t){const r=s[0];if(typeof r!="string")throw new TypeError("expected header name to be a string");const a=mn(s[1])?s[1]:[s[1]];let c=!1;for(const d of a)d!==void 0&&(e&&!c&&(c=!0,yield[r,null]),yield[r,d])}}const N=n=>{const e=new Headers,t=new Set;for(const s of n){const r=new Set;for(const[a,c]of ro(s)){const d=a.toLowerCase();r.has(d)||(e.delete(a),r.add(d)),c===null?(e.delete(a),t.add(d)):(e.append(a,c),t.delete(d))}}return{[Dr]:!0,values:e,nulls:t}};class Br extends R{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:N([{Accept:"application/octet-stream"},t==null?void 0:t.headers]),__binaryResponse:!0})}}class Wr extends R{create(e,t){return this._client.post("/audio/transcriptions",Ie({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class qr extends R{create(e,t){return this._client.post("/audio/translations",Ie({body:e,...t,__metadata:{model:e.model}},this._client))}}class pt extends R{constructor(){super(...arguments),this.transcriptions=new Wr(this._client),this.translations=new qr(this._client),this.speech=new Br(this._client)}}pt.Transcriptions=Wr;pt.Translations=qr;pt.Speech=Br;class Ur extends R{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(y`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",Q,{query:e,...t})}cancel(e,t){return this._client.post(y`/batches/${e}/cancel`,t)}}class Hr extends R{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:N([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(y`/assistants/${e}`,{...t,headers:N([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,s){return this._client.post(y`/assistants/${e}`,{body:t,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}list(e={},t){return this._client.getAPIList("/assistants",Q,{query:e,...t,headers:N([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(y`/assistants/${e}`,{...t,headers:N([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}let Xr=class extends R{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:N([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}};class Jr extends R{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:N([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}let Yt=class extends R{constructor(){super(...arguments),this.sessions=new Xr(this._client),this.transcriptionSessions=new Jr(this._client)}};Yt.Sessions=Xr;Yt.TranscriptionSessions=Jr;class Gr extends R{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:N([{"OpenAI-Beta":"chatkit_beta=v1"},t==null?void 0:t.headers])})}cancel(e,t){return this._client.post(y`/chatkit/sessions/${e}/cancel`,{...t,headers:N([{"OpenAI-Beta":"chatkit_beta=v1"},t==null?void 0:t.headers])})}}let Kr=class extends R{retrieve(e,t){return this._client.get(y`/chatkit/threads/${e}`,{...t,headers:N([{"OpenAI-Beta":"chatkit_beta=v1"},t==null?void 0:t.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",zt,{query:e,...t,headers:N([{"OpenAI-Beta":"chatkit_beta=v1"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(y`/chatkit/threads/${e}`,{...t,headers:N([{"OpenAI-Beta":"chatkit_beta=v1"},t==null?void 0:t.headers])})}listItems(e,t={},s){return this._client.getAPIList(y`/chatkit/threads/${e}/items`,zt,{query:t,...s,headers:N([{"OpenAI-Beta":"chatkit_beta=v1"},s==null?void 0:s.headers])})}};class Qt extends R{constructor(){super(...arguments),this.sessions=new Gr(this._client),this.threads=new Kr(this._client)}}Qt.Sessions=Gr;Qt.Threads=Kr;class Yr extends R{create(e,t,s){return this._client.post(y`/threads/${e}/messages`,{body:t,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}retrieve(e,t,s){const{thread_id:r}=t;return this._client.get(y`/threads/${r}/messages/${e}`,{...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}update(e,t,s){const{thread_id:r,...a}=t;return this._client.post(y`/threads/${r}/messages/${e}`,{body:a,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}list(e,t={},s){return this._client.getAPIList(y`/threads/${e}/messages`,Q,{query:t,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}delete(e,t,s){const{thread_id:r}=t;return this._client.delete(y`/threads/${r}/messages/${e}`,{...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}}class Qr extends R{retrieve(e,t,s){const{thread_id:r,run_id:a,...c}=t;return this._client.get(y`/threads/${r}/runs/${a}/steps/${e}`,{query:c,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}list(e,t,s){const{thread_id:r,...a}=t;return this._client.getAPIList(y`/threads/${r}/runs/${e}/steps`,Q,{query:a,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}}const ao=n=>{if(typeof Buffer<"u"){const e=Buffer.from(n,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(n),t=e.length,s=new Uint8Array(t);for(let r=0;r<t;r++)s[r]=e.charCodeAt(r);return Array.from(new Float32Array(s.buffer))}},Pe=n=>{var e,t,s,r,a;if(typeof globalThis.process<"u")return((t=(e=globalThis.process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof globalThis.Deno<"u")return(a=(r=(s=globalThis.Deno.env)==null?void 0:s.get)==null?void 0:r.call(s,n))==null?void 0:a.trim()};var re,Ce,As,ge,Ot,he,Re,De,ke,Ht,de,Pt,$t,dt,ot,lt,En,On,Pn,$n,Mn,Tn,Fn;class ut extends Fs{constructor(){super(...arguments),re.add(this),As.set(this,[]),ge.set(this,{}),Ot.set(this,{}),he.set(this,void 0),Re.set(this,void 0),De.set(this,void 0),ke.set(this,void 0),Ht.set(this,void 0),de.set(this,void 0),Pt.set(this,void 0),$t.set(this,void 0),dt.set(this,void 0)}[(As=new WeakMap,ge=new WeakMap,Ot=new WeakMap,he=new WeakMap,Re=new WeakMap,De=new WeakMap,ke=new WeakMap,Ht=new WeakMap,de=new WeakMap,Pt=new WeakMap,$t=new WeakMap,dt=new WeakMap,re=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{s=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{s=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{s=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((a,c)=>t.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Ce;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const s=t==null?void 0:t.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=be.fromReadableStream(e,this.controller);for await(const c of r)f(this,re,"m",ot).call(this,c);if((a=r.controller.signal)!=null&&a.aborted)throw new ue;return this._addRun(f(this,re,"m",lt).call(this))}toReadableStream(){return new be(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,r){const a=new Ce;return a._run(()=>a._runToolAssistantStream(e,t,s,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,s,r){var m;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const c={...s,stream:!0},d=await e.submitToolOutputs(t,c,{...r,signal:this.controller.signal});this._connected();for await(const p of d)f(this,re,"m",ot).call(this,p);if((m=d.controller.signal)!=null&&m.aborted)throw new ue;return this._addRun(f(this,re,"m",lt).call(this))}static createThreadAssistantStream(e,t,s){const r=new Ce;return r._run(()=>r._threadAssistantStream(e,t,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,s,r){const a=new Ce;return a._run(()=>a._runAssistantStream(e,t,s,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return f(this,Pt,"f")}currentRun(){return f(this,$t,"f")}currentMessageSnapshot(){return f(this,he,"f")}currentRunStepSnapshot(){return f(this,dt,"f")}async finalRunSteps(){return await this.done(),Object.values(f(this,ge,"f"))}async finalMessages(){return await this.done(),Object.values(f(this,Ot,"f"))}async finalRun(){if(await this.done(),!f(this,Re,"f"))throw Error("Final run was not received.");return f(this,Re,"f")}async _createThreadAssistantStream(e,t,s){var d;const r=s==null?void 0:s.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},c=await e.createAndRun(a,{...s,signal:this.controller.signal});this._connected();for await(const m of c)f(this,re,"m",ot).call(this,m);if((d=c.controller.signal)!=null&&d.aborted)throw new ue;return this._addRun(f(this,re,"m",lt).call(this))}async _createAssistantStream(e,t,s,r){var m;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const c={...s,stream:!0},d=await e.create(t,c,{...r,signal:this.controller.signal});this._connected();for await(const p of d)f(this,re,"m",ot).call(this,p);if((m=d.controller.signal)!=null&&m.aborted)throw new ue;return this._addRun(f(this,re,"m",lt).call(this))}static accumulateDelta(e,t){for(const[s,r]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=r;continue}let a=e[s];if(a==null){e[s]=r;continue}if(s==="index"||s==="type"){e[s]=r;continue}if(typeof a=="string"&&typeof r=="string")a+=r;else if(typeof a=="number"&&typeof r=="number")a+=r;else if(is(a)&&is(r))a=this.accumulateDelta(a,r);else if(Array.isArray(a)&&Array.isArray(r)){if(a.every(c=>typeof c=="string"||typeof c=="number")){a.push(...r);continue}for(const c of r){if(!is(c))throw new Error(`Expected array delta entry to be an object but got: ${c}`);const d=c.index;if(d==null)throw console.error(c),new Error("Expected array delta entry to have an `index` property");if(typeof d!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${d}`);const m=a[d];m==null?a.push(c):a[d]=this.accumulateDelta(m,c)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${r}, accValue: ${a}`);e[s]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,r){return await this._createAssistantStream(t,e,s,r)}async _runToolAssistantStream(e,t,s,r){return await this._createToolAssistantStream(t,e,s,r)}}Ce=ut,ot=function(e){if(!this.ended)switch(T(this,Pt,e,"f"),f(this,re,"m",Pn).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":f(this,re,"m",Fn).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":f(this,re,"m",On).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":f(this,re,"m",En).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},lt=function(){if(this.ended)throw new O("stream has ended, this shouldn't happen");if(!f(this,Re,"f"))throw Error("Final run has not been received");return f(this,Re,"f")},En=function(e){const[t,s]=f(this,re,"m",Mn).call(this,e,f(this,he,"f"));T(this,he,t,"f"),f(this,Ot,"f")[t.id]=t;for(const r of s){const a=t.content[r.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const r of e.data.delta.content){if(r.type=="text"&&r.text){let a=r.text,c=t.content[r.index];if(c&&c.type=="text")this._emit("textDelta",a,c.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=f(this,De,"f")){if(f(this,ke,"f"))switch(f(this,ke,"f").type){case"text":this._emit("textDone",f(this,ke,"f").text,f(this,he,"f"));break;case"image_file":this._emit("imageFileDone",f(this,ke,"f").image_file,f(this,he,"f"));break}T(this,De,r.index,"f")}T(this,ke,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(f(this,De,"f")!==void 0){const r=e.data.content[f(this,De,"f")];if(r)switch(r.type){case"image_file":this._emit("imageFileDone",r.image_file,f(this,he,"f"));break;case"text":this._emit("textDone",r.text,f(this,he,"f"));break}}f(this,he,"f")&&this._emit("messageDone",e.data),T(this,he,void 0,"f")}},On=function(e){const t=f(this,re,"m",$n).call(this,e);switch(T(this,dt,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const s=e.data.delta;if(s.step_details&&s.step_details.type=="tool_calls"&&s.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of s.step_details.tool_calls)a.index==f(this,Ht,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(f(this,de,"f")&&this._emit("toolCallDone",f(this,de,"f")),T(this,Ht,a.index,"f"),T(this,de,t.step_details.tool_calls[a.index],"f"),f(this,de,"f")&&this._emit("toolCallCreated",f(this,de,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":T(this,dt,void 0,"f"),e.data.step_details.type=="tool_calls"&&f(this,de,"f")&&(this._emit("toolCallDone",f(this,de,"f")),T(this,de,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Pn=function(e){f(this,As,"f").push(e),this._emit("event",e)},$n=function(e){switch(e.event){case"thread.run.step.created":return f(this,ge,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=f(this,ge,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){const r=Ce.accumulateDelta(t,s.delta);f(this,ge,"f")[e.data.id]=r}return f(this,ge,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":f(this,ge,"f")[e.data.id]=e.data;break}if(f(this,ge,"f")[e.data.id])return f(this,ge,"f")[e.data.id];throw new Error("No snapshot available")},Mn=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const a of r.delta.content)if(a.index in t.content){let c=t.content[a.index];t.content[a.index]=f(this,re,"m",Tn).call(this,a,c)}else t.content[a.index]=a,s.push(a);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Tn=function(e,t){return Ce.accumulateDelta(t,e)},Fn=function(e){switch(T(this,$t,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":T(this,Re,e.data,"f"),f(this,de,"f")&&(this._emit("toolCallDone",f(this,de,"f")),T(this,de,void 0,"f"));break}};let Bs=class extends R{constructor(){super(...arguments),this.steps=new Qr(this._client)}create(e,t,s){const{include:r,...a}=t;return this._client.post(y`/threads/${e}/runs`,{query:{include:r},body:a,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers]),stream:t.stream??!1})}retrieve(e,t,s){const{thread_id:r}=t;return this._client.get(y`/threads/${r}/runs/${e}`,{...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}update(e,t,s){const{thread_id:r,...a}=t;return this._client.post(y`/threads/${r}/runs/${e}`,{body:a,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}list(e,t={},s){return this._client.getAPIList(y`/threads/${e}/runs`,Q,{query:t,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}cancel(e,t,s){const{thread_id:r}=t;return this._client.post(y`/threads/${r}/runs/${e}/cancel`,{...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}async createAndPoll(e,t,s){const r=await this.create(e,t,s);return await this.poll(r.id,{thread_id:e},s)}createAndStream(e,t,s){return ut.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){var a;const r=N([s==null?void 0:s.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=s==null?void 0:s.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const{data:c,response:d}=await this.retrieve(e,t,{...s,headers:{...s==null?void 0:s.headers,...r}}).withResponse();switch(c.status){case"queued":case"in_progress":case"cancelling":let m=5e3;if(s!=null&&s.pollIntervalMs)m=s.pollIntervalMs;else{const p=d.headers.get("openai-poll-after-ms");if(p){const g=parseInt(p);isNaN(g)||(m=g)}}await ft(m);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return c}}}stream(e,t,s){return ut.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){const{thread_id:r,...a}=t;return this._client.post(y`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:a,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,s){const r=await this.submitToolOutputs(e,t,s);return await this.poll(r.id,t,s)}submitToolOutputsStream(e,t,s){return ut.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}};Bs.Steps=Qr;class Zt extends R{constructor(){super(...arguments),this.runs=new Bs(this._client),this.messages=new Yr(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:N([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(y`/threads/${e}`,{...t,headers:N([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,s){return this._client.post(y`/threads/${e}`,{body:t,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}delete(e,t){return this._client.delete(y`/threads/${e}`,{...t,headers:N([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:N([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){const s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return ut.createThreadAssistantStream(e,this._client.beta.threads,t)}}Zt.Runs=Bs;Zt.Messages=Yr;class Be extends R{constructor(){super(...arguments),this.realtime=new Yt(this._client),this.chatkit=new Qt(this._client),this.assistants=new Hr(this._client),this.threads=new Zt(this._client)}}Be.Realtime=Yt;Be.ChatKit=Qt;Be.Assistants=Hr;Be.Threads=Zt;class Zr extends R{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class Vr extends R{retrieve(e,t,s){const{container_id:r}=t;return this._client.get(y`/containers/${r}/files/${e}/content`,{...s,headers:N([{Accept:"application/binary"},s==null?void 0:s.headers]),__binaryResponse:!0})}}let Ws=class extends R{constructor(){super(...arguments),this.content=new Vr(this._client)}create(e,t,s){return this._client.post(y`/containers/${e}/files`,Ie({body:t,...s},this._client))}retrieve(e,t,s){const{container_id:r}=t;return this._client.get(y`/containers/${r}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList(y`/containers/${e}/files`,Q,{query:t,...s})}delete(e,t,s){const{container_id:r}=t;return this._client.delete(y`/containers/${r}/files/${e}`,{...s,headers:N([{Accept:"*/*"},s==null?void 0:s.headers])})}};Ws.Content=Vr;class qs extends R{constructor(){super(...arguments),this.files=new Ws(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(y`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",Q,{query:e,...t})}delete(e,t){return this._client.delete(y`/containers/${e}`,{...t,headers:N([{Accept:"*/*"},t==null?void 0:t.headers])})}}qs.Files=Ws;class ea extends R{create(e,t,s){const{include:r,...a}=t;return this._client.post(y`/conversations/${e}/items`,{query:{include:r},body:a,...s})}retrieve(e,t,s){const{conversation_id:r,...a}=t;return this._client.get(y`/conversations/${r}/items/${e}`,{query:a,...s})}list(e,t={},s){return this._client.getAPIList(y`/conversations/${e}/items`,zt,{query:t,...s})}delete(e,t,s){const{conversation_id:r}=t;return this._client.delete(y`/conversations/${r}/items/${e}`,s)}}class Us extends R{constructor(){super(...arguments),this.items=new ea(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(y`/conversations/${e}`,t)}update(e,t,s){return this._client.post(y`/conversations/${e}`,{body:t,...s})}delete(e,t){return this._client.delete(y`/conversations/${e}`,t)}}Us.Items=ea;class ta extends R{create(e,t){const s=!!e.encoding_format;let r=s?e.encoding_format:"base64";s&&ne(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const a=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return s?a:(ne(this._client).debug("embeddings/decoding base64 embeddings from base64"),a._thenUnwrap(c=>(c&&c.data&&c.data.forEach(d=>{const m=d.embedding;d.embedding=ao(m)}),c)))}}class sa extends R{retrieve(e,t,s){const{eval_id:r,run_id:a}=t;return this._client.get(y`/evals/${r}/runs/${a}/output_items/${e}`,s)}list(e,t,s){const{eval_id:r,...a}=t;return this._client.getAPIList(y`/evals/${r}/runs/${e}/output_items`,Q,{query:a,...s})}}class Hs extends R{constructor(){super(...arguments),this.outputItems=new sa(this._client)}create(e,t,s){return this._client.post(y`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){const{eval_id:r}=t;return this._client.get(y`/evals/${r}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList(y`/evals/${e}/runs`,Q,{query:t,...s})}delete(e,t,s){const{eval_id:r}=t;return this._client.delete(y`/evals/${r}/runs/${e}`,s)}cancel(e,t,s){const{eval_id:r}=t;return this._client.post(y`/evals/${r}/runs/${e}`,s)}}Hs.OutputItems=sa;class Xs extends R{constructor(){super(...arguments),this.runs=new Hs(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(y`/evals/${e}`,t)}update(e,t,s){return this._client.post(y`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",Q,{query:e,...t})}delete(e,t){return this._client.delete(y`/evals/${e}`,t)}}Xs.Runs=Hs;let na=class extends R{create(e,t){return this._client.post("/files",Ie({body:e,...t},this._client))}retrieve(e,t){return this._client.get(y`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",Q,{query:e,...t})}delete(e,t){return this._client.delete(y`/files/${e}`,t)}content(e,t){return this._client.get(y`/files/${e}/content`,{...t,headers:N([{Accept:"application/binary"},t==null?void 0:t.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=30*60*1e3}={}){const r=new Set(["processed","error","deleted"]),a=Date.now();let c=await this.retrieve(e);for(;!c.status||!r.has(c.status);)if(await ft(t),c=await this.retrieve(e),Date.now()-a>s)throw new Es({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return c}};class ra extends R{}let aa=class extends R{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class Js extends R{constructor(){super(...arguments),this.graders=new aa(this._client)}}Js.Graders=aa;class ia extends R{create(e,t,s){return this._client.getAPIList(y`/fine_tuning/checkpoints/${e}/permissions`,Kt,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get(y`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){const{fine_tuned_model_checkpoint:r}=t;return this._client.delete(y`/fine_tuning/checkpoints/${r}/permissions/${e}`,s)}}let Gs=class extends R{constructor(){super(...arguments),this.permissions=new ia(this._client)}};Gs.Permissions=ia;class oa extends R{list(e,t={},s){return this._client.getAPIList(y`/fine_tuning/jobs/${e}/checkpoints`,Q,{query:t,...s})}}class Ks extends R{constructor(){super(...arguments),this.checkpoints=new oa(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(y`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",Q,{query:e,...t})}cancel(e,t){return this._client.post(y`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList(y`/fine_tuning/jobs/${e}/events`,Q,{query:t,...s})}pause(e,t){return this._client.post(y`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(y`/fine_tuning/jobs/${e}/resume`,t)}}Ks.Checkpoints=oa;class We extends R{constructor(){super(...arguments),this.methods=new ra(this._client),this.jobs=new Ks(this._client),this.checkpoints=new Gs(this._client),this.alpha=new Js(this._client)}}We.Methods=ra;We.Jobs=Ks;We.Checkpoints=Gs;We.Alpha=Js;class la extends R{}class Ys extends R{constructor(){super(...arguments),this.graderModels=new la(this._client)}}Ys.GraderModels=la;class ca extends R{createVariation(e,t){return this._client.post("/images/variations",Ie({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",Ie({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class da extends R{retrieve(e,t){return this._client.get(y`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Kt,e)}delete(e,t){return this._client.delete(y`/models/${e}`,t)}}class ua extends R{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class ha extends R{accept(e,t,s){return this._client.post(y`/realtime/calls/${e}/accept`,{body:t,...s,headers:N([{Accept:"*/*"},s==null?void 0:s.headers])})}hangup(e,t){return this._client.post(y`/realtime/calls/${e}/hangup`,{...t,headers:N([{Accept:"*/*"},t==null?void 0:t.headers])})}refer(e,t,s){return this._client.post(y`/realtime/calls/${e}/refer`,{body:t,...s,headers:N([{Accept:"*/*"},s==null?void 0:s.headers])})}reject(e,t={},s){return this._client.post(y`/realtime/calls/${e}/reject`,{body:t,...s,headers:N([{Accept:"*/*"},s==null?void 0:s.headers])})}}class fa extends R{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class Vt extends R{constructor(){super(...arguments),this.clientSecrets=new fa(this._client),this.calls=new ha(this._client)}}Vt.ClientSecrets=fa;Vt.Calls=ha;function io(n,e){return!e||!lo(e)?{...n,output_parsed:null,output:n.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(s=>({...s,parsed:null}))}:t)}:ma(n,e)}function ma(n,e){const t=n.output.map(r=>{if(r.type==="function_call")return{...r,parsed_arguments:ho(e,r)};if(r.type==="message"){const a=r.content.map(c=>c.type==="output_text"?{...c,parsed:oo(e,c.text)}:c);return{...r,content:a}}return r}),s=Object.assign({},n,{output:t});return Object.getOwnPropertyDescriptor(n,"output_text")||ks(s),Object.defineProperty(s,"output_parsed",{enumerable:!0,get(){for(const r of s.output)if(r.type==="message"){for(const a of r.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),s}function oo(n,e){var t,s,r,a;return((s=(t=n.text)==null?void 0:t.format)==null?void 0:s.type)!=="json_schema"?null:"$parseRaw"in((r=n.text)==null?void 0:r.format)?((a=n.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function lo(n){var e;return!!Ms((e=n.text)==null?void 0:e.format)}function co(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function uo(n,e){return n.find(t=>t.type==="function"&&t.name===e)}function ho(n,e){const t=uo(n.tools??[],e.name);return{...e,...e,parsed_arguments:co(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function ks(n){const e=[];for(const t of n.output)if(t.type==="message")for(const s of t.content)s.type==="output_text"&&e.push(s.text);n.output_text=e.join("")}var $e,At,Ne,kt,zn,Ln,Dn,Bn;class Qs extends Fs{constructor(e){super(),$e.add(this),At.set(this,void 0),Ne.set(this,void 0),kt.set(this,void 0),T(this,At,e,"f")}static createResponse(e,t,s){const r=new Qs(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,s){var d;const r=s==null?void 0:s.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),f(this,$e,"m",zn).call(this);let a,c=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),c=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected();for await(const m of a)f(this,$e,"m",Ln).call(this,m,c);if((d=a.controller.signal)!=null&&d.aborted)throw new ue;return f(this,$e,"m",Dn).call(this)}[(At=new WeakMap,Ne=new WeakMap,kt=new WeakMap,$e=new WeakSet,zn=function(){this.ended||T(this,Ne,void 0,"f")},Ln=function(t,s){if(this.ended)return;const r=(c,d)=>{(s==null||d.sequence_number>s)&&this._emit(c,d)},a=f(this,$e,"m",Bn).call(this,t);switch(r("event",t),t.type){case"response.output_text.delta":{const c=a.output[t.output_index];if(!c)throw new O(`missing output at index ${t.output_index}`);if(c.type==="message"){const d=c.content[t.content_index];if(!d)throw new O(`missing content at index ${t.content_index}`);if(d.type!=="output_text")throw new O(`expected content to be 'output_text', got ${d.type}`);r("response.output_text.delta",{...t,snapshot:d.text})}break}case"response.function_call_arguments.delta":{const c=a.output[t.output_index];if(!c)throw new O(`missing output at index ${t.output_index}`);c.type==="function_call"&&r("response.function_call_arguments.delta",{...t,snapshot:c.arguments});break}default:r(t.type,t);break}},Dn=function(){if(this.ended)throw new O("stream has ended, this shouldn't happen");const t=f(this,Ne,"f");if(!t)throw new O("request ended without sending any events");T(this,Ne,void 0,"f");const s=fo(t,f(this,At,"f"));return T(this,kt,s,"f"),s},Bn=function(t){var r;let s=f(this,Ne,"f");if(!s){if(t.type!=="response.created")throw new O(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return s=T(this,Ne,t.response,"f"),s}switch(t.type){case"response.output_item.added":{s.output.push(t.item);break}case"response.content_part.added":{const a=s.output[t.output_index];if(!a)throw new O(`missing output at index ${t.output_index}`);const c=a.type,d=t.part;c==="message"&&d.type!=="reasoning_text"?a.content.push(d):c==="reasoning"&&d.type==="reasoning_text"&&(a.content||(a.content=[]),a.content.push(d));break}case"response.output_text.delta":{const a=s.output[t.output_index];if(!a)throw new O(`missing output at index ${t.output_index}`);if(a.type==="message"){const c=a.content[t.content_index];if(!c)throw new O(`missing content at index ${t.content_index}`);if(c.type!=="output_text")throw new O(`expected content to be 'output_text', got ${c.type}`);c.text+=t.delta}break}case"response.function_call_arguments.delta":{const a=s.output[t.output_index];if(!a)throw new O(`missing output at index ${t.output_index}`);a.type==="function_call"&&(a.arguments+=t.delta);break}case"response.reasoning_text.delta":{const a=s.output[t.output_index];if(!a)throw new O(`missing output at index ${t.output_index}`);if(a.type==="reasoning"){const c=(r=a.content)==null?void 0:r[t.content_index];if(!c)throw new O(`missing content at index ${t.content_index}`);if(c.type!=="reasoning_text")throw new O(`expected content to be 'reasoning_text', got ${c.type}`);c.text+=t.delta}break}case"response.completed":{T(this,Ne,t.response,"f");break}}return s},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{s=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{s=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{s=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((a,c)=>t.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=f(this,kt,"f");if(!e)throw new O("stream ended without producing a ChatCompletion");return e}}function fo(n,e){return io(n,e)}class pa extends R{list(e,t={},s){return this._client.getAPIList(y`/responses/${e}/input_items`,Q,{query:t,...s})}}class ga extends R{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}class es extends R{constructor(){super(...arguments),this.inputItems=new pa(this._client),this.inputTokens=new ga(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&ks(s),s))}retrieve(e,t={},s){return this._client.get(y`/responses/${e}`,{query:t,...s,stream:(t==null?void 0:t.stream)??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&ks(r),r))}delete(e,t){return this._client.delete(y`/responses/${e}`,{...t,headers:N([{Accept:"*/*"},t==null?void 0:t.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(s=>ma(s,e))}stream(e,t){return Qs.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(y`/responses/${e}/cancel`,t)}compact(e,t){return this._client.post("/responses/compact",{body:e,...t})}}es.InputItems=pa;es.InputTokens=ga;class ba extends R{create(e,t,s){return this._client.post(y`/uploads/${e}/parts`,Ie({body:t,...s},this._client))}}class Zs extends R{constructor(){super(...arguments),this.parts=new ba(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(y`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(y`/uploads/${e}/complete`,{body:t,...s})}}Zs.Parts=ba;const mo=async n=>{const e=await Promise.allSettled(n),t=e.filter(r=>r.status==="rejected");if(t.length){for(const r of t)console.error(r.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const s=[];for(const r of e)r.status==="fulfilled"&&s.push(r.value);return s};class xa extends R{create(e,t,s){return this._client.post(y`/vector_stores/${e}/file_batches`,{body:t,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}retrieve(e,t,s){const{vector_store_id:r}=t;return this._client.get(y`/vector_stores/${r}/file_batches/${e}`,{...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}cancel(e,t,s){const{vector_store_id:r}=t;return this._client.post(y`/vector_stores/${r}/file_batches/${e}/cancel`,{...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}async createAndPoll(e,t,s){const r=await this.create(e,t);return await this.poll(e,r.id,s)}listFiles(e,t,s){const{vector_store_id:r,...a}=t;return this._client.getAPIList(y`/vector_stores/${r}/file_batches/${e}/files`,Q,{query:a,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}async poll(e,t,s){var a;const r=N([s==null?void 0:s.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=s==null?void 0:s.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const{data:c,response:d}=await this.retrieve(t,{vector_store_id:e},{...s,headers:r}).withResponse();switch(c.status){case"in_progress":let m=5e3;if(s!=null&&s.pollIntervalMs)m=s.pollIntervalMs;else{const p=d.headers.get("openai-poll-after-ms");if(p){const g=parseInt(p);isNaN(g)||(m=g)}}await ft(m);break;case"failed":case"cancelled":case"completed":return c}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},r){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(r==null?void 0:r.maxConcurrency)??5,c=Math.min(a,t.length),d=this._client,m=t.values(),p=[...s];async function g(_){for(let x of _){const S=await d.files.create({file:x,purpose:"assistants"},r);p.push(S.id)}}const b=Array(c).fill(m).map(g);return await mo(b),await this.createAndPoll(e,{file_ids:p})}}class wa extends R{create(e,t,s){return this._client.post(y`/vector_stores/${e}/files`,{body:t,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}retrieve(e,t,s){const{vector_store_id:r}=t;return this._client.get(y`/vector_stores/${r}/files/${e}`,{...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}update(e,t,s){const{vector_store_id:r,...a}=t;return this._client.post(y`/vector_stores/${r}/files/${e}`,{body:a,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}list(e,t={},s){return this._client.getAPIList(y`/vector_stores/${e}/files`,Q,{query:t,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}delete(e,t,s){const{vector_store_id:r}=t;return this._client.delete(y`/vector_stores/${r}/files/${e}`,{...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}async createAndPoll(e,t,s){const r=await this.create(e,t,s);return await this.poll(e,r.id,s)}async poll(e,t,s){var a;const r=N([s==null?void 0:s.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=s==null?void 0:s.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const c=await this.retrieve(t,{vector_store_id:e},{...s,headers:r}).withResponse(),d=c.data;switch(d.status){case"in_progress":let m=5e3;if(s!=null&&s.pollIntervalMs)m=s.pollIntervalMs;else{const p=c.response.headers.get("openai-poll-after-ms");if(p){const g=parseInt(p);isNaN(g)||(m=g)}}await ft(m);break;case"failed":case"completed":return d}}}async upload(e,t,s){const r=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:r.id},s)}async uploadAndPoll(e,t,s){const r=await this.upload(e,t,s);return await this.poll(e,r.id,s)}content(e,t,s){const{vector_store_id:r}=t;return this._client.getAPIList(y`/vector_stores/${r}/files/${e}/content`,Kt,{...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}}class ts extends R{constructor(){super(...arguments),this.files=new wa(this._client),this.fileBatches=new xa(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:N([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(y`/vector_stores/${e}`,{...t,headers:N([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,s){return this._client.post(y`/vector_stores/${e}`,{body:t,...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",Q,{query:e,...t,headers:N([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(y`/vector_stores/${e}`,{...t,headers:N([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}search(e,t,s){return this._client.getAPIList(y`/vector_stores/${e}/search`,Kt,{body:t,method:"post",...s,headers:N([{"OpenAI-Beta":"assistants=v2"},s==null?void 0:s.headers])})}}ts.Files=wa;ts.FileBatches=xa;class ya extends R{create(e,t){return this._client.post("/videos",An({body:e,...t},this._client))}retrieve(e,t){return this._client.get(y`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",zt,{query:e,...t})}delete(e,t){return this._client.delete(y`/videos/${e}`,t)}downloadContent(e,t={},s){return this._client.get(y`/videos/${e}/content`,{query:t,...s,headers:N([{Accept:"application/binary"},s==null?void 0:s.headers]),__binaryResponse:!0})}remix(e,t,s){return this._client.post(y`/videos/${e}/remix`,An({body:t,...s},this._client))}}var Le,_a,Mt;class va extends R{constructor(){super(...arguments),Le.add(this)}async unwrap(e,t,s=this._client.webhookSecret,r=300){return await this.verifySignature(e,t,s,r),JSON.parse(e)}async verifySignature(e,t,s=this._client.webhookSecret,r=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");f(this,Le,"m",_a).call(this,s);const a=N([t]).values,c=f(this,Le,"m",Mt).call(this,a,"webhook-signature"),d=f(this,Le,"m",Mt).call(this,a,"webhook-timestamp"),m=f(this,Le,"m",Mt).call(this,a,"webhook-id"),p=parseInt(d,10);if(isNaN(p))throw new et("Invalid webhook timestamp format");const g=Math.floor(Date.now()/1e3);if(g-p>r)throw new et("Webhook timestamp is too old");if(p>g+r)throw new et("Webhook timestamp is too new");const b=c.split(" ").map(k=>k.startsWith("v1,")?k.substring(3):k),_=s.startsWith("whsec_")?Buffer.from(s.replace("whsec_",""),"base64"):Buffer.from(s,"utf-8"),x=m?`${m}.${d}.${e}`:`${d}.${e}`,S=await crypto.subtle.importKey("raw",_,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const k of b)try{const A=Buffer.from(k,"base64");if(await crypto.subtle.verify("HMAC",S,A,new TextEncoder().encode(x)))return}catch{continue}throw new et("The given webhook signature does not match the expected signature")}}Le=new WeakSet,_a=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Mt=function(e,t){if(!e)throw new Error("Headers are required");const s=e.get(t);if(s==null)throw new Error(`Missing required header: ${t}`);return s};var Cs,Vs,Tt,ja;class F{constructor({baseURL:e=Pe("OPENAI_BASE_URL"),apiKey:t=Pe("OPENAI_API_KEY"),organization:s=Pe("OPENAI_ORG_ID")??null,project:r=Pe("OPENAI_PROJECT_ID")??null,webhookSecret:a=Pe("OPENAI_WEBHOOK_SECRET")??null,...c}={}){if(Cs.add(this),Tt.set(this,void 0),this.completions=new Zr(this),this.chat=new Ds(this),this.embeddings=new ta(this),this.files=new na(this),this.images=new ca(this),this.audio=new pt(this),this.moderations=new ua(this),this.models=new da(this),this.fineTuning=new We(this),this.graders=new Ys(this),this.vectorStores=new ts(this),this.webhooks=new va(this),this.beta=new Be(this),this.batches=new Ur(this),this.uploads=new Zs(this),this.responses=new es(this),this.realtime=new Vt(this),this.conversations=new Us(this),this.evals=new Xs(this),this.containers=new qs(this),this.videos=new ya(this),t===void 0)throw new O("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const d={apiKey:t,organization:s,project:r,webhookSecret:a,...c,baseURL:e||"https://api.openai.com/v1"};if(!d.dangerouslyAllowBrowser&&pi())throw new O(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=d.baseURL,this.timeout=d.timeout??Vs.DEFAULT_TIMEOUT,this.logger=d.logger??console;const m="warn";this.logLevel=m,this.logLevel=Nn(d.logLevel,"ClientOptions.logLevel",this)??Nn(Pe("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??m,this.fetchOptions=d.fetchOptions,this.maxRetries=d.maxRetries??2,this.fetch=d.fetch??yi(),T(this,Tt,vi,"f"),this._options=d,this.apiKey=typeof t=="string"?t:"Missing Key",this.organization=s,this.project=r,this.webhookSecret=a}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return N([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return Ci(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Fe}`}defaultIdempotencyKey(){return`stainless-node-retry-${Xn()}`}makeStatusError(e,t,s,r){return ae.generate(e,t,s,r)}async _callApiKey(){const e=this._options.apiKey;if(typeof e!="function")return!1;let t;try{t=await e()}catch(s){throw s instanceof O?s:new O(`Failed to get token from 'apiKey' function: ${s.message}`,{cause:s})}if(typeof t!="string"||!t)throw new O(`Expected 'apiKey' function argument to return a string but it returned ${t}`);return this.apiKey=t,!0}buildURL(e,t,s){const r=!f(this,Cs,"m",ja).call(this)&&s||this.baseURL,a=di(e)?new URL(e):new URL(r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),c=this.defaultQuery();return ui(c)||(t={...c,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(a.search=this.stringifyQuery(t)),a.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(r=>({method:e,path:t,...r})))}request(e,t=null){return new Gt(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){var K,I;const r=await e,a=r.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(r);const{req:c,url:d,timeout:m}=await this.buildRequest(r,{retryCount:a-t});await this.prepareRequest(c,{url:d,options:r});const p="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),g=s===void 0?"":`, retryOf: ${s}`,b=Date.now();if(ne(this).debug(`[${p}] sending request`,Ae({retryOfRequestLogID:s,method:r.method,url:d,options:r,headers:c.headers})),(K=r.signal)!=null&&K.aborted)throw new ue;const _=new AbortController,x=await this.fetchWithTimeout(d,c,m,_).catch(gs),S=Date.now();if(x instanceof globalThis.Error){const $=`retrying, ${t} attempts remaining`;if((I=r.signal)!=null&&I.aborted)throw new ue;const E=ps(x)||/timed? ?out/i.test(String(x)+("cause"in x?String(x.cause):""));if(t)return ne(this).info(`[${p}] connection ${E?"timed out":"failed"} - ${$}`),ne(this).debug(`[${p}] connection ${E?"timed out":"failed"} (${$})`,Ae({retryOfRequestLogID:s,url:d,durationMs:S-b,message:x.message})),this.retryRequest(r,t,s??p);throw ne(this).info(`[${p}] connection ${E?"timed out":"failed"} - error; no more retries left`),ne(this).debug(`[${p}] connection ${E?"timed out":"failed"} (error; no more retries left)`,Ae({retryOfRequestLogID:s,url:d,durationMs:S-b,message:x.message})),E?new Es:new Xt({cause:x})}const k=[...x.headers.entries()].filter(([$])=>$==="x-request-id").map(([$,E])=>", "+$+": "+JSON.stringify(E)).join(""),A=`[${p}${g}${k}] ${c.method} ${d} ${x.ok?"succeeded":"failed"} with status ${x.status} in ${S-b}ms`;if(!x.ok){const $=await this.shouldRetry(x);if(t&&$){const U=`retrying, ${t} attempts remaining`;return await _i(x.body),ne(this).info(`${A} - ${U}`),ne(this).debug(`[${p}] response error (${U})`,Ae({retryOfRequestLogID:s,url:x.url,status:x.status,headers:x.headers,durationMs:S-b})),this.retryRequest(r,t,s??p,x.headers)}const E=$?"error; no more retries left":"error; not retryable";ne(this).info(`${A} - ${E}`);const D=await x.text().catch(U=>gs(U).message),L=mi(D),v=L?void 0:D;throw ne(this).debug(`[${p}] response error (${E})`,Ae({retryOfRequestLogID:s,url:x.url,status:x.status,headers:x.headers,message:v,durationMs:Date.now()-b})),this.makeStatusError(x.status,L,v,x.headers)}return ne(this).info(A),ne(this).debug(`[${p}] response start`,Ae({retryOfRequestLogID:s,url:x.url,status:x.status,headers:x.headers,durationMs:S-b})),{response:x,options:r,controller:_,requestLogID:p,retryOfRequestLogID:s,startTime:b}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){const s=this.makeRequest(t,null,void 0);return new Fi(this,s,e)}async fetchWithTimeout(e,t,s,r){const{signal:a,method:c,...d}=t||{};a&&a.addEventListener("abort",()=>r.abort());const m=setTimeout(()=>r.abort(),s),p=globalThis.ReadableStream&&d.body instanceof globalThis.ReadableStream||typeof d.body=="object"&&d.body!==null&&Symbol.asyncIterator in d.body,g={signal:r.signal,...p?{duplex:"half"}:{},method:"GET",...d};c&&(g.method=c.toUpperCase());try{return await this.fetch.call(void 0,e,g)}finally{clearTimeout(m)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,s,r){let a;const c=r==null?void 0:r.get("retry-after-ms");if(c){const m=parseFloat(c);Number.isNaN(m)||(a=m)}const d=r==null?void 0:r.get("retry-after");if(d&&!a){const m=parseFloat(d);Number.isNaN(m)?a=Date.parse(d)-Date.now():a=m*1e3}if(!(a&&0<=a&&a<60*1e3)){const m=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,m)}return await ft(a),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,c=Math.min(.5*Math.pow(2,a),8),d=1-Math.random()*.25;return c*d*1e3}async buildRequest(e,{retryCount:t=0}={}){const s={...e},{method:r,path:a,query:c,defaultBaseURL:d}=s,m=this.buildURL(a,c,d);"timeout"in s&&fi("timeout",s.timeout),s.timeout=s.timeout??this.timeout;const{bodyHeaders:p,body:g}=this.buildBody({options:s}),b=await this.buildHeaders({options:e,method:r,bodyHeaders:p,retryCount:t});return{req:{method:r,headers:b,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&g instanceof globalThis.ReadableStream&&{duplex:"half"},...g&&{body:g},...this.fetchOptions??{},...s.fetchOptions??{}},url:m,timeout:s.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:r}){let a={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const c=N([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...wi(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(c),c.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const s=N([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:ar(e)}:f(this,Tt,"f").call(this,{body:e,headers:s})}}Vs=F,Tt=new WeakMap,Cs=new WeakSet,ja=function(){return this.baseURL!=="https://api.openai.com/v1"};F.OpenAI=Vs;F.DEFAULT_TIMEOUT=6e5;F.OpenAIError=O;F.APIError=ae;F.APIConnectionError=Xt;F.APIConnectionTimeoutError=Es;F.APIUserAbortError=ue;F.NotFoundError=Yn;F.ConflictError=Qn;F.RateLimitError=Vn;F.BadRequestError=Jn;F.AuthenticationError=Gn;F.InternalServerError=er;F.PermissionDeniedError=Kn;F.UnprocessableEntityError=Zn;F.InvalidWebhookSignatureError=et;F.toFile=Wi;F.Completions=Zr;F.Chat=Ds;F.Embeddings=ta;F.Files=na;F.Images=ca;F.Audio=pt;F.Moderations=ua;F.Models=da;F.FineTuning=We;F.Graders=Ys;F.VectorStores=ts;F.Webhooks=va;F.Beta=Be;F.Batches=Ur;F.Uploads=Zs;F.Responses=es;F.Realtime=Vt;F.Conversations=Us;F.Evals=Xs;F.Containers=qs;F.Videos=ya;const po=`Eres un asistente especializado en comunicaciÃ³n para fotÃ³grafos de bodas profesionales.
Tu funciÃ³n es clasificar la informaciÃ³n  que te proporcionen sobre una boda concreta y, a partir de ella, redactar un texto para Instagram con estas caracterÃ­sticas:

	â¢	Humano
	â¢	CreÃ­ble
	â¢	Nada cursi
	â¢	Cercano
	â¢	Directo
	â¢	Sin florituras literarias

El texto debe parecer escrito por una persona real, con experiencia en bodas, que cuenta algo que realmente pasÃ³ ese dÃ­a.

[FORMATO DE SALIDA]

	â¢	Un Ãºnico caption para Instagram
	â¢	Texto fluido, dividido en pÃ¡rrafos cortos
	â¢	Lenguaje coloquial, natural y profesional
	â¢	MenciÃ³n integrada y natural de los proveedores (sin parecer publicidad)
	â¢	Sin hashtags
	â¢	Sin emojis
	â¢	Sin llamadas a la acciÃ³n

[RESTRICCIONES]

NO debes:

	â¢	Usar lenguaje cursi o empalagoso
	â¢	Usar clichÃ©s de boda (âamor eternoâ, âpara siempreâ, âcuento de hadasâ, etc.)
	â¢	Usar tono poÃ©tico o literario
	â¢	Usar emojis
	â¢	Inventar situaciones, emociones o hechos
	â¢	Sonar a texto de marketing
	â¢	Exceder 1000 caracteres
	

El texto debe contar algo, aunque sea pequeÃ±o, y transmitir que estuviste allÃ­.
`,go=()=>{const[n,e]=P.useState(()=>localStorage.getItem("openai_api_key")||""),[t,s]=P.useState(""),[r,a]=P.useState(""),[c,d]=P.useState(!1),[m,p]=P.useState(null);P.useEffect(()=>{n?localStorage.setItem("openai_api_key",n):localStorage.removeItem("openai_api_key")},[n]);const g=P.useCallback(async()=>{if(!n||!t.trim()){p("Por favor, introduce tu clave API y algunas ideas de texto.");return}d(!0),p(null),a("");try{const x=(await new F({apiKey:n,dangerouslyAllowBrowser:!0}).chat.completions.create({model:"gpt-4o",messages:[{role:"system",content:po},{role:"user",content:`Ideas del cliente: ${t}`}],max_tokens:150,temperature:.7})).choices[0].message.content.trim();a(x||"No se pudo obtener una respuesta de la IA.")}catch(b){console.error("OpenAI API Error:",b),p(`Error de API: ${b.message}. AsegÃºrate de que la clave es correcta y que tienes saldo.`)}finally{d(!1)}},[n,t]);return{apiKey:n,setApiKey:e,inputIdeas:t,setInputIdeas:s,rewrittenText:r,isLoading:c,error:m,rewriteText:g}},bo=({onClose:n})=>{const{apiKey:e,setApiKey:t,inputIdeas:s,setInputIdeas:r,rewrittenText:a,isLoading:c,error:d,rewriteText:m}=go(),p=P.useRef(null),g=!!e,b=()=>t("");return Un.useEffect(()=>{try{Rs({icons:Is})}catch{}},[c,d,e]),i.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/75 flex items-center justify-center p-4 overflow-y-auto",children:i.jsxs("div",{ref:p,className:"glass-panel p-6 rounded-3xl w-[90%] max-w-2xl flex flex-col gap-5 shadow-2xl border border-white/20 animate-in fade-in zoom-in-95 duration-200",onClick:_=>_.stopPropagation(),children:[i.jsxs("div",{className:"flex justify-between items-center border-b border-white/10 pb-3",children:[i.jsx("h2",{className:"text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500",children:"Asistente de RedacciÃ³n (IA)"}),i.jsx("button",{onClick:n,className:"text-zinc-400 hover:text-white",children:i.jsx("i",{"data-lucide":"x",className:"w-6 h-6"})})]}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("label",{className:"text-[10px] font-bold text-zinc-500 uppercase flex justify-between",children:[i.jsx("span",{children:"CLAVE API OPENAI"}),i.jsx("span",{className:"text-red-400",children:"*Guardada localmente"})]}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"password",value:e,onChange:_=>t(_.target.value),placeholder:"sk-...",readOnly:g,className:`
                                w-full bg-black/40 border border-white/10 rounded-lg p-3 text-white text-sm outline-none focus:border-blue-500
                                ${g?"opacity-80 cursor-default pr-12":""} 
                            `}),g&&i.jsx("button",{onClick:b,title:"Borrar Clave para ingresar una nueva",className:"absolute right-0 top-0 h-full px-3 text-zinc-400 hover:text-red-400 transition",children:i.jsx("i",{"data-lucide":"x",className:"w-5 h-5"})})]}),!e&&i.jsx("p",{className:"text-[10px] text-red-400",children:"Â¡Necesitas tu clave API para usar esta funciÃ³n!"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase",children:"Tus Ideas / Borrador"}),i.jsx("textarea",{value:s,onChange:_=>r(_.target.value),placeholder:"Escribe aquÃ­ toda la informaciÃ³n posible: ideas principales, pensamientos, sentimientos, tono deseado o borrador inicial. Cuanto mÃ¡s detalles proporciones, mejor serÃ¡ el texto final para el post de Instagram.",className:"w-full bg-black/40 border border-white/10 rounded-xl p-3 text-white text-sm outline-none focus:border-blue-500 min-h-[200px] resize-none"}),i.jsx("button",{onClick:m,disabled:c||!e||!s.trim(),className:"w-full bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed",children:c?i.jsxs(i.Fragment,{children:[i.jsx("i",{"data-lucide":"loader-2",className:"w-4 h-4 animate-spin"}),"Procesando..."]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{"data-lucide":"wand-2",className:"w-4 h-4"}),"Generar Texto Mejorado"]})}),d&&i.jsx("p",{className:"text-sm text-red-500 bg-red-900/50 p-2 rounded-lg text-center",children:d})]}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase",children:"Texto Reescribido (IA)"}),i.jsx("textarea",{readOnly:!0,value:a,placeholder:"El texto reescrito por la IA aparecerÃ¡ aquÃ­...",className:"w-full bg-black/40 border border-white/10 rounded-xl p-3 text-white text-sm outline-none min-h-[200px] resize-none"}),i.jsxs("button",{onClick:()=>navigator.clipboard.writeText(a),disabled:!a,className:"w-full bg-zinc-700 hover:bg-zinc-600 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[i.jsx("i",{"data-lucide":"clipboard",className:"w-4 h-4"}),"Copiar al Portapapeles"]})]})]})]})})},xo=({onClose:n})=>{P.useEffect(()=>{try{Rs({icons:Is})}catch{}},[]);const e=t=>{const s=document.getElementById(t);s&&s.scrollIntoView({behavior:"smooth"})};return i.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 animate-in fade-in duration-200",onClick:n,children:[i.jsxs("div",{className:"bg-zinc-900 border border-white/20 w-full max-w-4xl max-h-[90vh] rounded-3xl shadow-2xl flex flex-col overflow-hidden",onClick:t=>t.stopPropagation(),children:[i.jsxs("div",{className:"flex-none px-8 py-6 bg-zinc-900 border-b border-white/10 flex justify-between items-center z-20",children:[i.jsx("h2",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500",children:"GuÃ­a de Usuario - Panorama Studio"}),i.jsx("button",{onClick:n,className:"p-2 rounded-full bg-white/5 hover:bg-white/10 text-zinc-400 hover:text-white transition",children:i.jsx("i",{"data-lucide":"x",className:"w-6 h-6"})})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto p-8 space-y-10 scroll-smooth",children:[i.jsxs("div",{className:"flex flex-wrap gap-2 text-sm border-b border-white/10 pb-6",children:[i.jsxs("button",{onClick:()=>e("seccion-ia"),className:"btn-index",children:[i.jsx("i",{"data-lucide":"sparkles",className:"w-4 h-4 text-blue-400"})," Asistente IA"]}),i.jsxs("button",{onClick:()=>e("seccion-controles"),className:"btn-index",children:[i.jsx("i",{"data-lucide":"mouse-pointer-2",className:"w-4 h-4"})," Controles BÃ¡sicos"]}),i.jsxs("button",{onClick:()=>e("seccion-elementos"),className:"btn-index",children:[i.jsx("i",{"data-lucide":"layers-3",className:"w-4 h-4"})," GestiÃ³n de Elementos"]}),i.jsxs("button",{onClick:()=>e("seccion-exportar"),className:"btn-index",children:[i.jsx("i",{"data-lucide":"download",className:"w-4 h-4"})," Exportar"]})]}),i.jsxs("div",{id:"seccion-ia",className:"space-y-4 pt-2",children:[i.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-3",children:[i.jsx("i",{"data-lucide":"sparkles",className:"w-6 h-6 text-blue-400"}),"1. Asistente de RedacciÃ³n (IA)"]}),i.jsx("p",{className:"text-zinc-400",children:"Esta caracterÃ­stica utiliza la API de **OpenAI** (ChatGPT) para generar borradores de texto creativo, titulares o descripciones directamente relacionadas con el contenido de tu carrusel."}),i.jsxs("div",{className:"bg-zinc-800/50 p-4 rounded-xl space-y-3 border border-blue-600/50",children:[i.jsxs("h4",{className:"font-semibold text-lg text-white flex items-center gap-2",children:[i.jsx("i",{"data-lucide":"key",className:"w-5 h-5 text-blue-400"}),"1.1. Obtener la Clave API de OpenAI"]}),i.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-zinc-300 ml-4",children:[i.jsxs("li",{children:["Visita el sitio de desarrolladores de OpenAI:",i.jsx("a",{href:"https://platform.openai.com/",target:"_blank",rel:"noreferrer",className:"text-blue-400 hover:underline ml-1",children:"platform.openai.com"}),"."]}),i.jsx("li",{children:"Inicia sesiÃ³n o crea una cuenta."}),i.jsx("li",{children:"Ve a la secciÃ³n **API Keys** (Claves API) o a **Personal** > **View API keys**."}),i.jsx("li",{children:"Haz clic en **+ Create new secret key**."}),i.jsx("li",{children:"Copia la clave generada (empieza por `sk-...`). **IMPORTANTE:** Solo podrÃ¡s verla una vez."}),i.jsx("li",{children:"Recuerda que el uso de la API tiene un costo asociado por OpenAI, no por Panorama Studio."})]})]}),i.jsxs("div",{className:"bg-zinc-800/50 p-4 rounded-xl space-y-3 border border-blue-600/50",children:[i.jsxs("h4",{className:"font-semibold text-lg text-white flex items-center gap-2",children:[i.jsx("i",{"data-lucide":"plug-zap",className:"w-5 h-5 text-blue-400"}),"1.2. Uso de la API en la AplicaciÃ³n"]}),i.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-zinc-300 ml-4",children:[i.jsxs("li",{children:["Abre el panel haciendo clic en el botÃ³n",i.jsx("span",{className:"text-blue-400 font-bold",children:' "Asistente de RedacciÃ³n (IA)"'}),"(icono de brillo)."]}),i.jsx("li",{children:"En la parte superior del panel, pega la clave `sk-...` de OpenAI. Esta clave se guarda **Ãºnicamente en tu navegador** (Local Storage) y no es enviada a nuestros servidores."}),i.jsx("li",{children:'Escribe tu solicitud (ej: "5 ideas para un carrusel sobre React").'}),i.jsx("li",{children:"Haz clic en **Generar**. El texto resultante aparecerÃ¡ en el cuadro."}),i.jsx("li",{children:"Puedes copiar el texto al portapapeles o usar la funciÃ³n **AÃ±adir Texto al Canvas** si hay texto seleccionado en el lienzo."})]})]})]}),i.jsxs("div",{id:"seccion-controles",className:"space-y-4 pt-2",children:[i.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-3",children:[i.jsx("i",{"data-lucide":"mouse-pointer-2",className:"w-6 h-6 text-zinc-400"}),"2. Controles BÃ¡sicos y Atajos"]}),i.jsx("div",{className:"bg-zinc-800/50 p-4 rounded-xl space-y-3 text-zinc-300",children:i.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[i.jsxs("li",{children:[i.jsx("span",{className:"font-bold",children:"Moverse por el Canvas:"})," MantÃ©n presionada la tecla ",i.jsx("span",{className:"kbd",children:"Espacio"})," y arrastra el ratÃ³n."]}),i.jsxs("li",{children:[i.jsx("span",{className:"font-bold",children:"Zoom:"})," MantÃ©n presionada la tecla ",i.jsx("span",{className:"kbd",children:"Ctrl/Cmd"})," y usa la rueda del ratÃ³n (scroll)."]}),i.jsxs("li",{children:[i.jsx("span",{className:"font-bold",children:"Centrar Vista:"})," BotÃ³n ",i.jsx("i",{"data-lucide":"maximize",className:"w-4 h-4 inline-block"})," o ",i.jsx("span",{className:"kbd",children:"Ctrl/Cmd + 0"}),"."]}),i.jsxs("li",{children:[i.jsx("span",{className:"font-bold",children:"Snap de Elementos:"}),' Los elementos se "pegan" automÃ¡ticamente a los bordes y centros de las diapositivas al moverlos/escalarlos.']}),i.jsxs("li",{children:[i.jsx("span",{className:"font-bold",children:"Deshacer/Rehacer:"})," ",i.jsx("span",{className:"kbd",children:"Ctrl/Cmd + Z"})," / ",i.jsx("span",{className:"kbd",children:"Ctrl/Cmd + Shift + Z"}),"."]}),i.jsxs("li",{children:[i.jsx("span",{className:"font-bold",children:"Duplicar:"})," ",i.jsx("span",{className:"kbd",children:"Ctrl/Cmd + D"}),"."]}),i.jsxs("li",{children:[i.jsx("span",{className:"font-bold",children:"Movimiento Preciso:"})," Selecciona un elemento y usa las ",i.jsx("span",{className:"kbd",children:"Teclas de Flecha"})," (",i.jsx("span",{className:"kbd",children:"Shift"})," para movimientos de 10px)."]})]})})]}),i.jsxs("div",{id:"seccion-elementos",className:"space-y-4 pt-2",children:[i.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-3",children:[i.jsx("i",{"data-lucide":"layers-3",className:"w-6 h-6 text-zinc-400"}),"3. Propiedades de Elementos"]}),i.jsxs("div",{className:"bg-zinc-800/50 p-4 rounded-xl space-y-3 text-zinc-300",children:[i.jsx("p",{className:"font-bold",children:"Panel de Propiedades (Derecha):"}),i.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[i.jsx("li",{children:"Aparece automÃ¡ticamente al seleccionar un elemento."}),i.jsxs("li",{children:["Permite cambiar ",i.jsx("span",{className:"font-bold",children:"X, Y, Ancho, Alto"})," y aplicar ",i.jsx("span",{className:"font-bold",children:"Alineaciones"})," (al centro de la diapositiva actual)."]}),i.jsxs("li",{children:[i.jsx("span",{className:"font-bold",children:"ImÃ¡genes:"})," Incluye opciones para ",i.jsx("span",{className:"text-blue-400",children:"Enmascarar en Slide"})," (ajusta la imagen para cubrir el 100% de la diapositiva)."]}),i.jsxs("li",{children:[i.jsx("span",{className:"font-bold",children:"Formas:"})," Se puede ",i.jsx("span",{className:"text-green-400",children:"Rellenar con Imagen"})," y luego usar el modo ",i.jsx("span",{className:"text-purple-400",children:"Moviendo Foto Interior"})," para re-encuadrar la imagen dentro del marco."]}),i.jsxs("li",{children:[i.jsx("span",{className:"font-bold",children:"Capas:"})," Controla el orden de apilamiento de los elementos (Traer al Frente, Enviar AtrÃ¡s, etc.)."]})]}),i.jsx("p",{className:"font-bold mt-4",children:"Bloqueo de Slides:"}),i.jsx("ul",{className:"list-disc list-inside space-y-2 ml-4",children:i.jsxs("li",{children:["El botÃ³n ",i.jsx("i",{"data-lucide":"lock",className:"w-4 h-4 inline-block"})," debajo de cada diapositiva ",i.jsx("span",{className:"font-bold",children:"Bloquea"})," todos los elementos dentro de ese rango, previniendo movimientos accidentales mientras trabajas en otras zonas."]})})]})]}),i.jsxs("div",{id:"seccion-exportar",className:"space-y-4 pt-2",children:[i.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-3",children:[i.jsx("i",{"data-lucide":"download",className:"w-6 h-6 text-zinc-400"}),"4. ExportaciÃ³n y Guardado"]}),i.jsx("div",{className:"bg-zinc-800/50 p-4 rounded-xl space-y-3 text-zinc-300",children:i.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[i.jsxs("li",{children:[i.jsx("span",{className:"font-bold",children:"Guardar Proyecto:"})," BotÃ³n ",i.jsx("i",{"data-lucide":"save",className:"w-4 h-4 inline-block"})," o ",i.jsx("span",{className:"kbd",children:"Ctrl/Cmd + S"}),". Guarda un archivo `.json` que incluye todos tus elementos y ajustes, permitiendo reanudar el trabajo mÃ¡s tarde."]}),i.jsxs("li",{children:[i.jsx("span",{className:"font-bold",children:"Descargar Todo (ZIP):"})," Disponible en la ",i.jsx("span",{className:"text-green-400",children:"Vista Previa (Ojo)"}),". Exporta cada diapositiva como un archivo PNG individual, listo para subir como carrusel."]})]})})]}),i.jsx("div",{className:"pt-8 text-center text-xs text-zinc-600 border-t border-white/10",children:"Panorama Studio v1.0"})]})]}),i.jsx("style",{jsx:!0,children:`
                .btn-index {
                    @apply flex items-center gap-2 px-3 py-1.5 bg-white/5 hover:bg-white/10 rounded-lg transition text-zinc-300 hover:text-white border border-white/5;
                }
                .kbd {
                    @apply px-1.5 py-0.5 bg-zinc-700 rounded text-xs font-mono text-white mx-1 border border-zinc-600;
                }
            `})]})},wo=({position:n,selected:e,selProps:t,filterValues:s,colors:r,shapeFileInputRef:a,onStartDrag:c,onDuplicate:d,onDelete:m,onPropChange:p,onAlign:g,onRotate:b,onFlip:_,onFillSlide:x,onMaskToSlide:S,onToggleShapeEdit:k,onShapeColorChange:A,onShapeFillInput:K,onTriggerShapeInput:I,onLayerAction:$,onOpacityChange:E,onOpacityCommit:D,onFilterChange:L})=>e?i.jsxs("div",{className:"fixed w-80 glass-panel rounded-2xl p-4 flex flex-col gap-4 z-50 shadow-2xl animate-[fadeIn_0.2s] max-h-[85vh] overflow-y-auto",style:{left:n.x,top:n.y},children:[i.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-white/10 cursor-move-grab",onPointerDown:c,children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("i",{"data-lucide":"sliders-horizontal",className:"w-4 h-4 text-zinc-500"}),i.jsx("span",{className:"text-xs font-bold text-zinc-500 uppercase select-none",children:"Propiedades"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("button",{onPointerDown:v=>v.stopPropagation(),onClick:d,className:"text-zinc-400 p-1 hover:bg-white/10 rounded",title:"Duplicar",children:i.jsx("i",{"data-lucide":"copy",className:"w-4 h-4"})}),i.jsx("button",{onPointerDown:v=>v.stopPropagation(),onClick:m,className:"text-red-400 p-1 hover:bg-red-400/10 rounded",title:"Eliminar",children:i.jsx("i",{"data-lucide":"trash-2",className:"w-4 h-4"})})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("div",{className:"num-input-group flex-1",children:[i.jsx("label",{className:"num-input-label",children:"X"}),i.jsx("input",{type:"number",value:t.x,onChange:v=>p("x",v.target.value),className:"num-input"})]}),i.jsxs("div",{className:"num-input-group flex-1",children:[i.jsx("label",{className:"num-input-label",children:"Y"}),i.jsx("input",{type:"number",value:t.y,onChange:v=>p("y",v.target.value),className:"num-input"})]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("div",{className:"num-input-group flex-1",children:[i.jsx("label",{className:"num-input-label",children:"Ancho"}),i.jsx("input",{type:"number",value:t.w,onChange:v=>p("w",v.target.value),className:"num-input"})]}),i.jsxs("div",{className:"num-input-group flex-1",children:[i.jsx("label",{className:"num-input-label",children:"Alto"}),i.jsx("input",{type:"number",value:t.h,onChange:v=>p("h",v.target.value),className:"num-input"})]})]})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsxs("label",{className:"text-[10px] font-bold text-zinc-500 uppercase flex items-center gap-1",children:[i.jsx("i",{"data-lucide":"droplet",className:"w-3 h-3"})," Opacidad"]}),i.jsxs("span",{className:"text-[10px] font-mono text-zinc-300 bg-zinc-800 px-1 rounded",children:[t.opacity,"%"]})]}),i.jsx("div",{className:"flex items-center h-4",children:i.jsx("input",{type:"range",min:"0",max:"100",step:"1",value:t.opacity||100,onChange:E,onMouseUp:D,onTouchEnd:D,className:"w-full h-1 bg-zinc-700 rounded-lg appearance-none cursor-pointer accent-blue-500 hover:accent-blue-400"})})]}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase",children:"PosiciÃ³n"}),i.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[i.jsx("button",{onClick:()=>g("h-center"),className:"btn-icon bg-zinc-800 hover:bg-zinc-700 text-xs",title:"Centrar Horizontal",children:i.jsx("i",{"data-lucide":"align-center-horizontal",className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>g("v-center"),className:"btn-icon bg-zinc-800 hover:bg-zinc-700 text-xs",title:"Centrar Vertical",children:i.jsx("i",{"data-lucide":"align-center-vertical",className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>b(),className:"btn-icon bg-zinc-800 hover:bg-zinc-700 text-xs",title:"Rotar",children:i.jsx("i",{"data-lucide":"rotate-cw",className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>_("X"),className:"btn-icon bg-zinc-800 hover:bg-zinc-700 text-xs",title:"Voltear",children:i.jsx("i",{"data-lucide":"flip-horizontal",className:"w-4 h-4"})})]})]}),e.type==="image"&&!e.isShapeFill&&i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase mb-2 block",children:"Ajuste RÃ¡pido"}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("button",{onClick:x,className:"w-full bg-zinc-800 hover:bg-zinc-700 text-white rounded-lg py-2 text-xs font-bold flex items-center justify-center gap-2 transition",children:[i.jsx("i",{"data-lucide":"maximize",className:"w-3 h-3"})," Rellenar (Libre)"]}),i.jsxs("button",{onClick:S,className:`w-full rounded-lg py-2 text-xs font-bold flex items-center justify-center gap-2 transition ${e.hasMask?"bg-red-600 hover:bg-red-500 text-white":"bg-blue-600 hover:bg-blue-500 text-white"}`,children:[i.jsx("i",{"data-lucide":e.hasMask?"scissors":"crop",className:"w-3 h-3"}),e.hasMask?"Quitar MÃ¡scara":"Enmascarar en Slide"]})]})]}),e.isShapeFill&&i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase mb-2 block",children:"EdiciÃ³n de Marco"}),i.jsxs("button",{onClick:k,className:`w-full rounded-lg py-2 text-xs font-bold flex items-center justify-center gap-2 transition ${e.isEditingContent?"bg-purple-600 text-white":"bg-green-600 text-white"}`,children:[i.jsx("i",{"data-lucide":e.isEditingContent?"unlock":"lock",className:"w-3 h-3"}),e.isEditingContent?"Moviendo Foto Interior":"Moviendo Marco Completo"]})]}),e.type==="image"&&i.jsx("div",{className:"border-t border-white/10 pt-2 mt-2",children:i.jsxs("details",{className:"group",children:[i.jsxs("summary",{className:"flex items-center justify-between p-2 cursor-pointer list-none text-zinc-400 hover:text-white transition-colors bg-zinc-800/50 hover:bg-zinc-800 rounded-lg select-none",children:[i.jsxs("span",{className:"text-[10px] font-bold uppercase flex items-center gap-2",children:[i.jsx("i",{"data-lucide":"wand-2",className:"w-3 h-3 text-purple-400"})," Filtros y Efectos"]}),i.jsx("i",{"data-lucide":"chevron-down",className:"w-3 h-3 transition-transform group-open:rotate-180"})]}),i.jsxs("div",{className:"p-3 space-y-4 bg-black/20 rounded-lg mt-2 animate-in slide-in-from-top-1",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("button",{onClick:()=>L("grayscale",!(s!=null&&s.grayscale)),className:`flex items-center justify-center gap-2 p-2 rounded border transition ${s!=null&&s.grayscale?"bg-zinc-200 text-black border-white":"bg-zinc-800 text-zinc-400 border-white/10 hover:bg-zinc-700"}`,children:[i.jsx("i",{"data-lucide":s!=null&&s.grayscale?"toggle-right":"toggle-left",className:"w-4 h-4"}),i.jsx("span",{className:"text-[10px] font-bold",children:"B&N"})]}),i.jsxs("button",{onClick:()=>L("blackwhite",!(s!=null&&s.blackwhite)),className:`flex items-center justify-center gap-2 p-2 rounded border transition ${s!=null&&s.blackwhite?"bg-zinc-200 text-black border-white":"bg-zinc-800 text-zinc-400 border-white/10 hover:bg-zinc-700"}`,children:[i.jsx("i",{"data-lucide":s!=null&&s.blackwhite?"toggle-right":"toggle-left",className:"w-4 h-4"}),i.jsx("span",{className:"text-[10px] font-bold",children:"Art B&N"})]})]}),i.jsxs("div",{className:"flex items-center justify-between pt-1 border-t border-white/5 mt-1",children:[i.jsx("span",{className:"text-[10px] text-zinc-500 uppercase font-bold",children:"Tinte"}),i.jsx("div",{className:"flex gap-1",children:["","#3b82f6","#ef4444","#eab308","#22c55e","#a855f7"].map((v,H)=>i.jsx("button",{onClick:()=>L("blendcolor",v),className:`w-4 h-4 rounded-full border border-white/10 hover:scale-125 transition ${v?"":"bg-zinc-800 text-[8px] flex items-center justify-center text-red-500"}`,style:{backgroundColor:v},title:v||"Quitar tinte",children:!v&&"â"},H))})]}),i.jsxs("div",{className:"space-y-3 pt-2 border-t border-white/5",children:[i.jsx(Me,{label:"Brillo",type:"brightness",min:-.5,max:.5,step:.01,currentValue:s==null?void 0:s.brightness,onChange:L,color:"accent-yellow-500"}),i.jsx(Me,{label:"Contraste",type:"contrast",min:-.5,max:.5,step:.01,currentValue:s==null?void 0:s.contrast,onChange:L,color:"accent-zinc-200"}),i.jsx(Me,{label:"SaturaciÃ³n",type:"saturation",min:-1,max:1,step:.01,currentValue:s==null?void 0:s.saturation,onChange:L,color:"accent-pink-500"}),i.jsx(Me,{label:"Matiz (Hue)",type:"hue",min:-1,max:1,step:.01,currentValue:s==null?void 0:s.hue,onChange:L,color:"accent-indigo-500"})]}),i.jsxs("div",{className:"space-y-3 pt-2 border-t border-white/5",children:[i.jsx(Me,{label:"Desenfoque",type:"blur",min:0,max:1,step:.01,def:0,currentValue:s==null?void 0:s.blur,color:"accent-blue-500",onChange:L}),i.jsx(Me,{label:"Ruido (Grano)",type:"noise",min:0,max:1,step:.01,def:0,currentValue:s==null?void 0:s.noise,color:"accent-emerald-500",onChange:L})]})]})]})}),e.type==="text"&&i.jsx("div",{className:"text-xs text-zinc-400 italic text-center py-2 bg-zinc-800/50 rounded",children:"Doble clic para editar texto"}),(e.type==="rect"||e.type==="circle"||e.type==="triangle")&&i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase mb-2 block",children:"Color"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(v=>i.jsx("div",{onClick:()=>A(v),className:`color-swatch ${e.fill===v?"active":""}`,style:{backgroundColor:v},title:v},v))})]}),i.jsxs("div",{className:"border-t border-white/10 pt-2",children:[i.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase mb-2 block",children:"Imagen de Fondo"}),i.jsxs("button",{onClick:I,className:"w-full bg-zinc-800 hover:bg-zinc-700 text-white rounded-lg py-2 text-xs font-bold flex items-center justify-center gap-2 transition",children:[i.jsx("i",{"data-lucide":"image-plus",className:"w-3 h-3"})," Rellenar con Imagen"]}),i.jsx("input",{ref:a,type:"file",accept:"image/*",onChange:K,className:"hidden"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase mb-2 block",children:"Capas"}),i.jsxs("div",{className:"flex justify-between items-center bg-zinc-900/50 rounded-lg p-1",children:[i.jsx("button",{onClick:()=>$("bottom"),className:"btn-icon w-8 h-8",children:i.jsx("i",{"data-lucide":"chevrons-down",className:"w-4 h-4"})}),i.jsx("div",{className:"w-px h-4 bg-white/10"}),i.jsx("button",{onClick:()=>$("down"),className:"btn-icon w-8 h-8",children:i.jsx("i",{"data-lucide":"minus",className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>$("up"),className:"btn-icon w-8 h-8",children:i.jsx("i",{"data-lucide":"plus",className:"w-4 h-4"})}),i.jsx("div",{className:"w-px h-4 bg-white/10"}),i.jsx("button",{onClick:()=>$("top"),className:"btn-icon w-8 h-8",children:i.jsx("i",{"data-lucide":"chevrons-up",className:"w-4 h-4"})})]})]}),i.jsx("style",{jsx:!0,children:`
        .filter-chip {
            @apply flex items-center gap-2 bg-zinc-800 p-2 rounded cursor-pointer hover:bg-zinc-700 transition text-[10px] text-zinc-300 select-none border border-white/5;
        }
      `})]}):null,Me=({label:n,type:e,min:t,max:s,step:r,def:a=0,currentValue:c,color:d="accent-white",onChange:m})=>{const p=c!==void 0?c:a,g=Math.round(p*100)/100;return i.jsxs("div",{className:"flex flex-col gap-1 group",children:[i.jsxs("div",{className:"flex justify-between items-center text-[9px] text-zinc-500 font-bold uppercase",children:[i.jsxs("span",{className:"flex items-center gap-1",children:[n,p!==a&&i.jsx("button",{onClick:()=>m(e,a),title:"Resetear",className:"text-blue-400 hover:text-white p-0.5 rounded-full hover:bg-white/10",children:i.jsx("i",{"data-lucide":"rotate-ccw",className:"w-3 h-3"})})]}),i.jsx("span",{className:`font-mono ${p!==a?"text-white":"text-zinc-600"}`,children:g})]}),i.jsx("input",{type:"range",min:t,max:s,step:r,value:p,onChange:b=>m(e,parseFloat(b.target.value)),className:`w-full h-1 bg-zinc-700 rounded-lg appearance-none cursor-pointer ${d} opacity-80 hover:opacity-100 transition-opacity`})]})},yo=({isOpen:n,textState:e,setTextState:t,onClose:s,onSave:r,fonts:a,colors:c})=>n?i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"glass-panel p-6 rounded-3xl w-[90%] max-w-lg flex flex-col gap-5 shadow-2xl border border-white/20 animate-in fade-in zoom-in-95 duration-200",children:[i.jsx("h2",{className:"text-lg font-bold text-white text-center tracking-tight",children:e.objRef?"Editar Texto":"Nuevo Texto"}),i.jsx("textarea",{autoFocus:!0,value:e.content,onChange:d=>t({...e,content:d.target.value}),style:{fontFamily:e.fontFamily,fontWeight:e.fontWeight,fontStyle:e.fontStyle},placeholder:"Escribe tu texto aquÃ­...",className:"w-full bg-black/40 border border-white/10 rounded-xl p-4 text-white text-2xl outline-none focus:border-blue-500 min-h-[120px] resize-none text-center"}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase",children:"TipografÃ­a"}),i.jsx("div",{className:"flex flex-col gap-1 bg-black/20 p-1 rounded-xl max-h-40 overflow-y-auto",children:a.map(d=>i.jsx("button",{onClick:()=>t({...e,fontFamily:d.family}),className:`px-3 py-2 text-left rounded-lg text-sm transition ${e.fontFamily===d.family?"bg-blue-600 text-white":"text-zinc-400 hover:bg-white/5"}`,style:{fontFamily:d.family},children:d.name},d.name))})]}),i.jsxs("div",{className:"flex flex-col gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase mb-2 block",children:"Estilo"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>t({...e,fontWeight:e.fontWeight==="bold"?"normal":"bold"}),className:`flex-1 p-2 rounded-lg border transition font-bold ${e.fontWeight==="bold"?"bg-white text-black border-white":"border-zinc-700 text-zinc-500 hover:border-zinc-500"}`,children:"B"}),i.jsx("button",{onClick:()=>t({...e,fontStyle:e.fontStyle==="italic"?"normal":"italic"}),className:`flex-1 p-2 rounded-lg border transition italic ${e.fontStyle==="italic"?"bg-white text-black border-white":"border-zinc-700 text-zinc-500 hover:border-zinc-500"}`,children:"I"})]})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"text-[10px] font-bold text-zinc-500 uppercase mb-2 block flex justify-between",children:[i.jsx("span",{children:"TamaÃ±o"})," ",i.jsxs("span",{children:[e.fontSize,"px"]})]}),i.jsx("input",{type:"range",min:"40",max:"400",step:"10",value:e.fontSize,onChange:d=>t({...e,fontSize:parseInt(d.target.value)}),className:"w-full h-1 bg-zinc-700 rounded-lg appearance-none cursor-pointer accent-white"})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase mb-2 block",children:"Color"}),i.jsx("div",{className:"flex flex-wrap gap-2 justify-center bg-black/20 p-2 rounded-xl",children:c.map(d=>i.jsx("div",{onClick:()=>t({...e,color:d}),className:`color-swatch ${e.color===d?"active":""}`,style:{backgroundColor:d}},d))})]}),i.jsxs("div",{className:"flex gap-3 pt-2 border-t border-white/10",children:[i.jsx("button",{onClick:s,className:"flex-1 py-3 rounded-xl font-bold text-zinc-400 hover:bg-white/5 transition",children:"Cancelar"}),i.jsx("button",{onClick:r,className:"flex-1 py-3 rounded-xl font-bold bg-white text-black hover:bg-zinc-200 transition",children:e.objRef?"Actualizar Texto":"AÃ±adir Texto"})]})]})}):null,_o=({isOpen:n,onClose:e,previewImg:t,slideIndex:s,totalSlides:r,onNavigate:a,onExport:c,isExporting:d})=>n?i.jsx("div",{className:"modal-overlay",onClick:e,children:i.jsxs("div",{className:"relative flex flex-col items-center justify-center gap-4",onClick:m=>m.stopPropagation(),children:[i.jsx("button",{onClick:e,className:"absolute -top-8 right-0 text-white/50 hover:text-white transition",children:i.jsx("i",{"data-lucide":"x",className:"w-8 h-8"})}),i.jsx("button",{onClick:()=>a(-1),className:`absolute -left-16 top-1/2 -translate-y-1/2 p-4 rounded-full bg-white/10 hover:bg-white/20 text-white transition ${s===0?"opacity-30 pointer-events-none":""}`,children:i.jsx("i",{"data-lucide":"chevron-left",className:"w-8 h-8"})}),i.jsx("button",{onClick:()=>a(1),className:`absolute -right-16 top-1/2 -translate-y-1/2 p-4 rounded-full bg-white/10 hover:bg-white/20 text-white transition ${s===r-1?"opacity-30 pointer-events-none":""}`,children:i.jsx("i",{"data-lucide":"chevron-right",className:"w-8 h-8"})}),i.jsxs("div",{className:"w-[350px] bg-white rounded-[40px] border-[10px] border-zinc-800 overflow-hidden shadow-2xl relative",children:[i.jsxs("div",{className:"flex justify-between items-center p-3 border-b border-gray-100",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-8 h-8 bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-500 rounded-full p-[2px]",children:i.jsx("div",{className:"w-full h-full bg-white rounded-full border border-white"})}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-xs font-bold text-black leading-tight",children:"mi_panorama"}),i.jsx("span",{className:"text-[10px] text-gray-500 leading-tight",children:"Instagram"})]})]}),i.jsx("i",{"data-lucide":"more-horizontal",className:"w-5 h-5 text-black"})]}),i.jsxs("div",{className:"w-full aspect-[4/5] bg-gray-100 overflow-hidden relative",children:[t&&i.jsx("div",{className:"h-full flex transition-transform duration-300 ease-out",style:{width:`${r*100}%`,transform:`translateX(-${s*100/r}%)`},children:i.jsx("img",{src:t,className:"h-full w-full object-cover",style:{objectFit:"fill"},alt:"Preview"})}),i.jsxs("div",{className:"absolute top-3 right-3 bg-black/60 text-white text-[10px] font-bold px-2 py-1 rounded-full",children:[s+1,"/",r]})]}),i.jsxs("div",{className:"p-3",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsxs("div",{className:"flex gap-4",children:[i.jsx("i",{"data-lucide":"heart",className:"w-6 h-6 text-black"}),i.jsx("i",{"data-lucide":"message-circle",className:"w-6 h-6 text-black"}),i.jsx("i",{"data-lucide":"send",className:"w-6 h-6 text-black"})]}),i.jsx("i",{"data-lucide":"bookmark",className:"w-6 h-6 text-black"})]}),i.jsx("div",{className:"flex justify-center gap-1 mb-2",children:Array.from({length:r}).map((m,p)=>i.jsx("div",{className:`w-1.5 h-1.5 rounded-full transition-colors ${p===s?"bg-blue-500":"bg-gray-300"}`},p))}),i.jsx("div",{className:"text-xs font-bold text-black mb-1",children:"2,453 Me gusta"}),i.jsxs("div",{className:"text-xs text-black",children:[i.jsx("span",{className:"font-bold",children:"mi_panorama"})," Mira este carrusel increÃ­ble creado con Panorama Studio ð¥"]}),i.jsx("div",{className:"text-[10px] text-gray-400 mt-1 uppercase",children:"HACE 2 HORAS"})]}),i.jsxs("div",{className:"border-t border-gray-100 p-3 flex justify-around items-center",children:[i.jsx("i",{"data-lucide":"home",className:"w-6 h-6 text-black"}),i.jsx("i",{"data-lucide":"search",className:"w-6 h-6 text-gray-400"}),i.jsx("i",{"data-lucide":"plus-square",className:"w-6 h-6 text-gray-400"}),i.jsx("i",{"data-lucide":"video",className:"w-6 h-6 text-gray-400"}),i.jsx("div",{className:"w-6 h-6 bg-gray-300 rounded-full"})]}),i.jsx("div",{className:"absolute bottom-1 left-1/2 -translate-x-1/2 w-32 h-1 bg-black rounded-full"})]}),i.jsx("button",{onClick:c,disabled:d,className:`bg-blue-600 hover:bg-blue-500 text-white px-8 py-3 rounded-xl font-bold flex items-center gap-2 shadow-lg transition transform hover:scale-105 ${d?"opacity-50 cursor-not-allowed":""}`,children:d?i.jsxs(i.Fragment,{children:[i.jsx("i",{"data-lucide":"loader-2",className:"w-5 h-5 animate-spin"}),"Procesando..."]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{"data-lucide":"download",className:"w-5 h-5"}),"Descargar Todo (ZIP)"]})})]})}):null,Ve=(n,e,t)=>Math.min(Math.max(n,e),t),Wn=n=>n.toJSON(["isGuide","isHGuide","excludeFromExport","isShapeFill","isEditingContent","id"]),ms=(n,e="dataURL")=>new Promise((t,s)=>{const r=new FileReader;r.onload=a=>t(a.target.result),r.onerror=a=>s(a),e==="text"?r.readAsText(n):r.readAsDataURL(n)}),vo=async(n,e,t)=>{const{slideW:s,slideH:r,guidesRef:a}=t,c=new ii,d=a.current.map(m=>m.visible);a.current.forEach(m=>m.visible=!1),n.renderAll();try{for(let p=0;p<e;p++){const b=n.toDataURL({format:"png",left:p*s,top:0,width:s,height:r,multiplier:1,quality:1}).replace(/^data:image\/png;base64,/,"");c.file(`slide_${p+1}.png`,b,{base64:!0})}const m=await c.generateAsync({type:"blob"});Hn.saveAs(m,"panorama_slides.zip")}catch(m){throw new Error("Error generando ZIP: "+m.message)}finally{a.current.forEach((m,p)=>m.visible=d[p]),n.requestRenderAll()}},G=1080,V=1350,Te=20,qn=["#000000","#FFFFFF","#F87171","#FB923C","#FBBF24","#34D399","#22D3EE","#60A5FA","#818CF8","#A78BFA","#E879F9","#FB7185","#e4e4e7","#52525b"],jo=[{name:"Moderna (Inter)",family:"Inter"},{name:"Elegante (Playfair)",family:"Playfair Display"},{name:"GeomÃ©trica (Montserrat)",family:"Montserrat"},{name:"Impacto (Oswald)",family:"Oswald"},{name:"Manuscrita (Dancing)",family:"Dancing Script"},{name:"Universal (Poppins)",family:"Poppins"},{name:"Robusta (Roboto Slab)",family:"Roboto Slab"},{name:"CÃ³digo (Source Code Pro)",family:"Source Code Pro"},{name:"Corporativa (Lato)",family:"Lato"},{name:"Legible (Open Sans)",family:"Open Sans"},{name:"Editorial (Merriweather)",family:"Merriweather"},{name:"Divertida (Pacifico)",family:"Pacifico"}],No=()=>{const n=P.useRef(null),e=P.useRef(null),t=P.useRef(null),s=P.useRef(null),r=P.useRef(null),a=P.useRef(null),c=P.useRef([]),d=P.useRef({stack:[],index:-1,isApplying:!1}),m=P.useRef(3),p=P.useRef(!1),[g,b]=P.useState(3),[_,x]=P.useState(Array(3).fill(!1)),[S,k]=P.useState(!1),[A,K]=P.useState(!1),[I,$]=P.useState(null),[E,D]=P.useState({x:0,y:0,w:0,h:0,opacity:100}),[L,v]=P.useState({}),[H,U]=P.useState({x:0,y:0,zoom:.25}),[X,B]=P.useState(!1),[_e,qe]=P.useState({x:window.innerWidth-340,y:100}),[Ue,He]=P.useState(!1),ss=P.useRef({x:0,y:0}),[Xe,Je]=P.useState(!1),[Ge,en]=P.useState(!1),[gt,tn]=P.useState(!1),[Ke,sn]=P.useState(!1),[Ye,nn]=P.useState(!1),[fe,ns]=P.useState({content:"",color:"#FFFFFF",fontSize:120,fontFamily:"Inter",fontWeight:"normal",fontStyle:"normal",objRef:null}),[Na,Sa]=P.useState(null),[Aa,rn]=P.useState(0),[ka,an]=P.useState(!1),[on,ln]=P.useState(!1),rs=P.useRef({startX:0,startY:0}),[Ca,cn]=P.useState(!1),me=P.useMemo(()=>g*G,[g]);P.useEffect(()=>{m.current=g},[g]),P.useEffect(()=>{p.current=A},[A]),P.useEffect(()=>{try{Rs({icons:Is})}catch{}},[I,Xe,Ge,Ye,X,A,gt,_,g,Ke,L]),P.useEffect(()=>{const l=window.matchMedia("(max-width: 1024px)"),o=()=>k(l.matches);return o(),l.addListener(o),()=>l.removeListener(o)},[]),P.useEffect(()=>{x(l=>{const o=Array(g).fill(!1);for(let h=0;h<Math.min(l.length,g);h++)o[h]=l[h];return o})},[g]);const Y=()=>{const l=a.current;if(!l||d.current.isApplying)return;const o=JSON.stringify(Wn(l)),h=d.current;h.index>=0&&h.stack[h.index]===o||(h.stack=h.stack.slice(0,h.index+1),h.stack.push(o),h.index=h.stack.length-1,h.stack.length>50&&(h.stack.shift(),h.index--))},bt=l=>{const o=a.current,h=d.current,u=Ve(h.index+l,0,h.stack.length-1);!o||u===h.index||(h.isApplying=!0,h.index=u,o.loadFromJSON(JSON.parse(h.stack[u]),()=>{wt(o,g,A),Qe(o),o.requestRenderAll(),h.isApplying=!1}))},dn=()=>{const l=a.current;if(!l)return;const o=Wn(l),h={version:"1.0",timestamp:Date.now(),slides:g,canvas:o},u=new Blob([JSON.stringify(h)],{type:"application/json"});Hn.saveAs(u,"proyecto-panorama.json")},Ra=async l=>{const o=l.target.files[0];if(o){try{const h=await ms(o,"text"),u=JSON.parse(h);u.slides&&(b(u.slides),m.current=u.slides);const w=a.current;w.clear(),w.backgroundColor="#ffffff",w.loadFromJSON(u.canvas,()=>{wt(w,u.slides||g,A),Qe(w),w.requestRenderAll(),d.current={stack:[],index:-1,isApplying:!1},Y(),setTimeout(()=>yt(u.slides?u.slides*G:me),100)})}catch(h){alert("Error al cargar el archivo de proyecto."),console.error(h)}l.target.value=""}},Ia=async()=>{const l=a.current;if(l){an(!0);try{await vo(l,g,{slideW:G,slideH:V,guidesRef:c})}catch(o){console.error("Error generando ZIP:",o),alert("Hubo un error al crear el archivo ZIP.")}finally{an(!1)}}},Ea=l=>{const o=m.current,h=p.current,u=l.target;if(!u||u.isGuide)return;xt();const w=u.getScaledWidth(),M=u.getScaledHeight();let C=!1;const q=[];for(let j=0;j<=o;j++)q.push(j*G),j<o&&q.push(j*G+G/2);for(const j of q){if(Math.abs(u.left-j)<Te){u.left=j,C=!0,Ee(j,!1);break}if(Math.abs(u.left+w-j)<Te){u.left=j-w,C=!0,Ee(j,!1);break}if(Math.abs(u.left+w/2-j)<Te){u.left=j-w/2,C=!0,Ee(j,!1);break}}if(h){const j=V/2;Math.abs(u.top+M/2-j)<Te&&(u.top=j-M/2,Ee(j,!0))}C&&u.setCoords()},Oa=l=>{const o=m.current,h=l.target;if(!h||h.isGuide)return;xt();const u=h.width*h.scaleX,w=h.left,M=w+u,C=[];for(let j=0;j<=o;j++)C.push(j*G);let q=!1;for(const j of C){if(Math.abs(M-j)<Te){const z=j-w;if(z>10){const te=z/h.width;h.set({scaleX:te}),h.type==="image"&&h.set({scaleY:te}),Ee(j,!1),q=!0;break}}if(Math.abs(w-j)<Te){const z=M-j;if(z>10){const te=z/h.width;h.set({left:j,scaleX:te}),h.type==="image"&&h.set({scaleY:te}),Ee(j,!1),q=!0;break}}}q||xt()};P.useEffect(()=>{if(a.current)return;W.fabric.textureSize=4096;const l=new W.fabric.Canvas(n.current,{height:V,width:me,backgroundColor:"#ffffff",preserveObjectStacking:!0,selection:!0,renderOnAddRemove:!1,enableRetinaScaling:!1,uniformScaling:!0});a.current=l;const o=u=>{u&&D({x:Math.round(u.left),y:Math.round(u.top),w:Math.round(u.getScaledWidth()),h:Math.round(u.getScaledHeight()),opacity:Math.round((u.opacity!==void 0?u.opacity:1)*100)})},h=()=>{const u=l.getActiveObject();if(!u){$(null),v({});return}const w={};u.type==="image"&&u.filters&&u.filters.forEach(M=>{const C=M.type.toLowerCase();C==="brightness"&&(w.brightness=M.brightness),C==="contrast"&&(w.contrast=M.contrast),C==="saturation"&&(w.saturation=M.saturation),C==="huerotation"&&(w.hue=M.rotation),C==="gamma"&&(w.gamma=M.gamma[0]),C==="blur"&&(w.blur=M.blur),C==="noise"&&(w.noise=M.noise/100),C==="pixelate"&&(w.pixelate=M.blocksize),C==="grayscale"&&(w.grayscale=!0),C==="blackwhite"&&(w.blackwhite=!0),C==="blendcolor"&&(w.blendcolor=M.color)}),v(w),$({type:u.type,fill:u.fill,hasMask:!!u.clipPath,isShapeFill:u.isShapeFill,isEditingContent:u.isEditingContent}),o(u)};return l.on("selection:created",h),l.on("selection:updated",h),l.on("selection:cleared",()=>{$(null),v({})}),l.on("object:moving",u=>{Ea(u),o(u.target);const w=u.target;if(w.isShapeFill&&!w.isEditingContent&&w.clipPath){const M=w.left-(w._lastLeft||w.left),C=w.top-(w._lastTop||w.top);w.clipPath.left+=M,w.clipPath.top+=C,w._lastLeft=w.left,w._lastTop=w.top}}),l.on("mouse:down",u=>{u.target&&(u.target._lastLeft=u.target.left,u.target._lastTop=u.target.top)}),l.on("object:modified",()=>{xt(),Y(),h()}),l.on("object:scaling",u=>{Oa(u),o(u.target)}),l.on("mouse:dblclick",u=>{u.target&&u.target.type==="text"&&(ns({content:u.target.text,color:u.target.fill,fontSize:u.target.fontSize,fontFamily:u.target.fontFamily,fontWeight:u.target.fontWeight,fontStyle:u.target.fontStyle,objRef:u.target}),Je(!0))}),wt(l,g,A),l.renderAll(),Y(),setTimeout(()=>yt(me),100),()=>{}},[]),P.useEffect(()=>{a.current&&(a.current.setWidth(me),a.current.setHeight(V),wt(a.current,g,A),Qe(a.current),a.current.requestRenderAll())},[A,g,me]);const Pa=l=>{const o=parseInt(l.target.value,10),h=a.current,u=h.getActiveObject();u&&(u.set("opacity",o/100),h.requestRenderAll(),D(w=>({...w,opacity:o})))},$a=()=>{Y()},Ma=(l,o)=>{const h=a.current,u=h.getActiveObject();if(!u||u.type!=="image")return;v(j=>({...j,[l]:o}));const w=(j,z)=>{switch(j){case"brightness":return new W.fabric.Image.filters.Brightness({brightness:z});case"contrast":return new W.fabric.Image.filters.Contrast({contrast:z});case"saturation":return new W.fabric.Image.filters.Saturation({saturation:z});case"hue":return new W.fabric.Image.filters.HueRotation({rotation:z});case"gamma":return new W.fabric.Image.filters.Gamma({gamma:[z,z,z]});case"blur":return new W.fabric.Image.filters.Blur({blur:z});case"noise":return new W.fabric.Image.filters.Noise({noise:z*100});case"grayscale":return new W.fabric.Image.filters.Grayscale;case"blackwhite":return new W.fabric.Image.filters.BlackWhite;case"blendcolor":return new W.fabric.Image.filters.BlendColor({color:z,mode:"tint",alpha:.5});default:return null}};let C=l.charAt(0).toUpperCase()+l.slice(1);l==="hue"&&(C="HueRotation"),l==="blackwhite"&&(C="BlackWhite"),l==="blendcolor"&&(C="BlendColor");const q=u.filters.findIndex(j=>j.type===C);if(l==="grayscale"||l==="blackwhite")if(o&&q===-1){const j=l==="grayscale"?"BlackWhite":"Grayscale",z=u.filters.findIndex(te=>te.type===j);z>-1&&(u.filters.splice(z,1),v(te=>({...te,[j.toLowerCase()]:!1}))),u.filters.push(w(l,o))}else!o&&q>-1&&u.filters.splice(q,1);else if(l==="blendcolor")q>-1?o?u.filters[q].color=o:u.filters.splice(q,1):o&&u.filters.push(w(l,o));else if(q>-1){const j=u.filters[q];l==="brightness"?j.brightness=o:l==="contrast"?j.contrast=o:l==="saturation"?j.saturation=o:l==="hue"?j.rotation=o:l==="gamma"?j.gamma=[o,o,o]:l==="blur"?j.blur=o:l==="noise"&&(j.noise=o*100),(l==="gamma"&&o===1||l!=="gamma"&&o===0)&&u.filters.splice(q,1)}else l==="gamma"&&o===1||l!=="gamma"&&o===0||u.filters.push(w(l,o));u.applyFilters(),h.requestRenderAll()},un=async(l,o=null)=>{if(!(!l||!l.type.startsWith("image/")))try{const h=await ms(l),u=new Image;u.src=h,await new Promise(C=>{u.onload=C});let w=h;const M=4096;if(u.width>M||u.height>M){const C=M/Math.max(u.width,u.height),q=u.width*C,j=u.height*C,z=document.createElement("canvas");z.width=q,z.height=j,z.getContext("2d").drawImage(u,0,0,q,j),w=z.toDataURL("image/jpeg",.92)}W.fabric.Image.fromURL(w,C=>{const j=Math.min(G,V)*.8/Math.max(C.width,C.height);let z,te;o?(z=(o.x-H.x)/H.zoom-C.width*j/2,te=(o.y-H.y)/H.zoom-C.height*j/2):(z=me/2-C.width*j/2,te=V/2-C.height*j/2),C.set({left:z,top:te,scaleX:j,scaleY:j,uniformScaling:!0}),a.current.add(C),a.current.setActiveObject(C),Y(),a.current.requestRenderAll()})}catch(h){console.error("Error leyendo imagen:",h)}},Ta=l=>{un(l.target.files[0]),l.target.value=""},Fa=l=>{l.preventDefault(),B(!0)},za=l=>{l.preventDefault(),B(!1)},La=l=>{l.preventDefault(),B(!1);const o=l.dataTransfer.files;o&&o.length>0&&un(o[0],{x:l.clientX,y:l.clientY})},Da=async l=>{const o=l.target.files[0];if(o){try{const h=await ms(o),u=a.current,w=u.getActiveObject();w&&W.fabric.Image.fromURL(h,M=>{const C=w.getScaledWidth()/M.width,q=w.getScaledHeight()/M.height,j=Math.max(C,q);M.set({left:w.left,top:w.top,scaleX:j,scaleY:j,isShapeFill:!0,isEditingContent:!1}),M.setPositionByOrigin(w.getCenterPoint(),"center","center"),w.clone(z=>{z.set({absolutePositioned:!0,fill:"transparent",stroke:"transparent",selectable:!1,evented:!1}),M.clipPath=z;const te=u.getObjects().indexOf(w);u.insertAt(M,te),u.remove(w),u.setActiveObject(M),u.requestRenderAll(),Y()})})}catch(h){console.error(h)}l.target.value=""}},Ba=()=>{const l=a.current,o=l.getActiveObject();o&&o.isShapeFill&&(o.isEditingContent=!o.isEditingContent,o._lastLeft=o.left,o._lastTop=o.top,$(h=>({...h,isEditingContent:o.isEditingContent})),l.requestRenderAll())},hn=()=>{const l=a.current,o=l.getActiveObject();o&&o.clone(h=>{l.discardActiveObject(),h.set({left:o.left+20,top:o.top+20,evented:!0}),o.type==="activeSelection"?(h.canvas=l,h.forEachObject(u=>l.add(u)),h.setCoords()):l.add(h),o.isShapeFill&&(h.set({isShapeFill:!0,isEditingContent:!1}),o.clipPath&&o.clipPath.clone(u=>{u.set({left:h.left,top:h.top,absolutePositioned:!0}),h.clipPath=u,l.requestRenderAll()})),l.setActiveObject(h),l.requestRenderAll(),Y()})},Wa=()=>{const l=a.current,o=l.getActiveObject();if(!o)return;const h=o.getCenterPoint(),u=o.angle||0;o.set("angle",(u+90)%360),o.setPositionByOrigin(h,"center","center"),o.setCoords(),l.requestRenderAll(),Y()},qa=l=>{const o=a.current,h=o.getActiveObject();if(!h)return;const u=h.getCenterPoint();l==="X"&&h.set("flipX",!h.flipX),l==="Y"&&h.set("flipY",!h.flipY),h.setPositionByOrigin(u,"center","center"),h.setCoords(),o.requestRenderAll(),Y()};P.useEffect(()=>{const l=h=>{Ue&&qe({x:Ve(h.clientX-ss.current.x,0,window.innerWidth-330),y:Ve(h.clientY-ss.current.y,0,window.innerHeight-300)})},o=()=>He(!1);return Ue&&(window.addEventListener("pointermove",l),window.addEventListener("pointerup",o)),()=>{window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",o)}},[Ue]);const Ua=l=>{l.stopPropagation(),l.preventDefault();const o=l.currentTarget.parentElement.getBoundingClientRect();ss.current={x:l.clientX-o.left,y:l.clientY-o.top},He(!0)},Ha=(l,o)=>{const h=a.current,u=h.getActiveObject();if(!u)return;const w=parseInt(o,10);if(!isNaN(w)){if(l==="x"&&u.set("left",w),l==="y"&&u.set("top",w),l==="w"){const M=w/u.width;u.set({scaleX:M,scaleY:M})}if(l==="h"){const M=w/u.height;u.set({scaleX:M,scaleY:M})}u.setCoords(),h.requestRenderAll(),D(M=>({...M,[l]:w})),Y()}},Xa=l=>{const o=a.current,h=o.getActiveObject();if(!h)return;const u=h.getCenterPoint(),M=Math.floor(u.x/G)*G;if(l==="h-center"){const C=M+(G-h.getScaledWidth())/2;h.set("left",C)}if(l==="v-center"){const C=(V-h.getScaledHeight())/2;h.set("top",C)}h.setCoords(),o.requestRenderAll(),Y(),D({x:Math.round(h.left),y:Math.round(h.top),w:Math.round(h.getScaledWidth()),h:Math.round(h.getScaledHeight()),opacity:Math.round((h.opacity!==void 0?h.opacity:1)*100)})},Ja=()=>{const l=a.current,o=l.getActiveObject();if(!o||o.type!=="image")return;const h=G,u=V,w=o.getCenterPoint(),C=Math.floor(w.x/G)*G,q=h/o.width,j=u/o.height,z=Math.max(q,j);o.set({scaleX:z,scaleY:z});const te=C+(h-o.getScaledWidth())/2,ri=(u-o.getScaledHeight())/2;o.set({left:te,top:ri}),o.setCoords(),l.requestRenderAll(),Y(),D({x:Math.round(o.left),y:Math.round(o.top),w:Math.round(o.getScaledWidth()),h:Math.round(o.getScaledHeight()),opacity:Math.round((o.opacity!==void 0?o.opacity:1)*100)})},Ga=()=>{const l=a.current,o=l.getActiveObject();if(!o||o.type!=="image")return;if(o.clipPath){o.clipPath=null,o.dirty=!0,l.requestRenderAll(),$(z=>({...z,hasMask:!1})),Y();return}const h=o.getCenterPoint(),w=Math.floor(h.x/G)*G,M=G/o.width,C=V/o.height,q=Math.max(M,C);o.set({scaleX:q,scaleY:q,left:w+(G-o.width*q)/2,top:(V-o.height*q)/2});const j=new W.fabric.Rect({left:w,top:0,width:G,height:V,absolutePositioned:!0});o.clipPath=j,o.dirty=!0,o.setCoords(),l.requestRenderAll(),$(z=>({...z,hasMask:!0})),D({x:Math.round(o.left),y:Math.round(o.top),w:Math.round(o.getScaledWidth()),h:Math.round(o.getScaledHeight()),opacity:Math.round((o.opacity!==void 0?o.opacity:1)*100)}),Y()},Ka=()=>{const l=a.current;c.current.forEach(h=>h.visible=!1),l.renderAll();const o=l.toDataURL({format:"png",multiplier:.5});c.current.forEach(h=>h.visible=!0),l.renderAll(),Sa(o),rn(0),nn(!0)},Ya=l=>{rn(o=>Ve(o+l,0,g-1))},Qa=l=>{const o=a.current,h=o.getActiveObject();h&&(h.type==="rect"||h.type==="circle"||h.type==="triangle")&&(h.set("fill",l),$(u=>({...u,fill:l})),o.requestRenderAll(),Y())},xt=()=>{let l=!1;c.current.forEach(o=>{(o.stroke!=="#3b82f6"||o.strokeWidth!==2)&&(o.set({stroke:"#3b82f6",strokeWidth:2,opacity:.5}),l=!0)}),l&&a.current.requestRenderAll()},Ee=(l,o=!1)=>{let h=!1;c.current.forEach(u=>{let w=!1;o&&u.isHGuide?Math.abs(u.y1-l)<1&&(w=!0):!o&&!u.isHGuide&&Math.abs(u.x1-l)<1&&(w=!0),w&&u.stroke!=="#06b6d4"&&(u.set({stroke:"#06b6d4",strokeWidth:4,opacity:1}),h=!0)}),h&&a.current.requestRenderAll()},wt=(l,o,h)=>{l.getObjects().filter(w=>w.isGuide).forEach(w=>l.remove(w)),c.current=[];for(let w=0;w<=o;w++)if(w>0&&w<o){const M=new W.fabric.Line([w*G,0,w*G,V],{stroke:"#3b82f6",strokeWidth:2,strokeDashArray:[10,10],selectable:!1,evented:!1,opacity:.5,isGuide:!0,originX:"center"});l.add(M),c.current.push(M)}if(h){const w=new W.fabric.Line([0,V/2,o*G,V/2],{stroke:"#3b82f6",strokeWidth:2,strokeDashArray:[10,10],selectable:!1,evented:!1,opacity:.5,isGuide:!0,isHGuide:!0,originY:"center"});l.add(w),c.current.push(w)}},Qe=l=>c.current.forEach(o=>l.bringToFront(o)),Za=()=>{ns({content:"",color:"#000000",fontSize:120,fontFamily:"Inter",fontWeight:"bold",fontStyle:"normal",objRef:null}),Je(!0)},Va=()=>{const l=a.current;if(!l||!fe.content.trim()){Je(!1);return}const o={text:fe.content,fill:fe.color,fontSize:fe.fontSize,fontFamily:fe.fontFamily,fontWeight:fe.fontWeight,fontStyle:fe.fontStyle};if(fe.objRef)fe.objRef.set(o);else{const h=new W.fabric.Text(o.text,{...o,left:me/2,top:V/2,originX:"center",originY:"center",centeredRotation:!0});l.add(h),l.setActiveObject(h)}Qe(l),l.requestRenderAll(),Y(),Je(!1)};P.useEffect(()=>{const l=o=>{if(Xe||Ye||Ge||Ke||S)return;const h=a.current,u=h==null?void 0:h.getActiveObject(),w=o.metaKey||o.ctrlKey,C=o.shiftKey?10:1;(o.key==="Backspace"||o.key==="Delete")&&fn(),w&&o.key==="z"&&(o.preventDefault(),o.shiftKey?bt(1):bt(-1)),w&&o.key==="d"&&(o.preventDefault(),hn()),o.code==="Space"&&(o.type==="keydown"?cn(!0):cn(!1)),w&&o.key==="0"&&(o.preventDefault(),yt()),w&&o.key==="s"&&(o.preventDefault(),dn()),u&&(o.key==="ArrowLeft"||o.key==="ArrowRight"||o.key==="ArrowUp"||o.key==="ArrowDown")&&(o.preventDefault(),o.key==="ArrowLeft"&&(u.left-=C),o.key==="ArrowRight"&&(u.left+=C),o.key==="ArrowUp"&&(u.top-=C),o.key==="ArrowDown"&&(u.top+=C),u.setCoords(),h.requestRenderAll(),D({x:Math.round(u.left),y:Math.round(u.top),w:Math.round(u.getScaledWidth()),h:Math.round(u.getScaledHeight()),opacity:Math.round((u.opacity!==void 0?u.opacity:1)*100)}))};return window.addEventListener("keydown",l),window.addEventListener("keyup",l),()=>{window.removeEventListener("keydown",l),window.removeEventListener("keyup",l)}},[Xe,Ye,Ge,Ke,g,S]);const yt=(l=me)=>{if(!e.current)return;const o=e.current.clientWidth,h=e.current.clientHeight,u=Math.min((o-100)/l,(h-100)/V,.9);U({x:(o-l*u)/2,y:(h-V*u)/2,zoom:u})},as=l=>{const o=e.current.getBoundingClientRect(),h=Ve(H.zoom*l,.05,5);U(u=>({zoom:h,x:o.width/2-(o.width/2-u.x)*(h/u.zoom),y:o.height/2-(o.height/2-u.y)*(h/u.zoom)}))},ei=()=>{const l=new W.fabric.Rect({left:me/2-200,top:V/2-200,width:400,height:400,fill:"#e4e4e7"});a.current.add(l),a.current.setActiveObject(l),Y(),a.current.requestRenderAll()},fn=()=>{const l=a.current,o=l.getActiveObject();o&&(l.remove(o),l.discardActiveObject(),Y(),l.requestRenderAll())},ti=l=>{const o=a.current,h=o.getActiveObject();h&&(l==="top"?o.bringToFront(h):l==="up"?o.bringForward(h,!0):l==="down"?o.sendBackwards(h,!0):l==="bottom"&&o.sendToBack(h),Qe(o),o.requestRenderAll(),Y())},si=l=>{const o=a.current;!o||!e.current||(li(o,l,{view:H,containerWidth:e.current.clientWidth,containerHeight:e.current.clientHeight}),Y(),tn(!1))},ni=l=>{const o=a.current;if(!o)return;const h=[..._],u=!h[l];h[l]=u,x(h),o.discardActiveObject(),o.getObjects().forEach(w=>{if(w.isGuide)return;const M=w.getCenterPoint();Math.floor(M.x/G)===l&&w.set({selectable:!u,evented:!u,lockMovementX:u,lockMovementY:u,lockRotation:u,lockScalingX:u,lockScalingY:u,hasControls:!u,hoverCursor:u?"default":"move"})}),o.requestRenderAll()};return S?i.jsx("div",{className:"w-full h-full flex items-center justify-center p-6 bg-zinc-900 text-zinc-200 text-center select-none",children:i.jsxs("div",{className:"max-w-md bg-zinc-800 p-8 rounded-3xl shadow-2xl border border-zinc-700 flex flex-col items-center gap-6",children:[i.jsx("i",{"data-lucide":"monitor",className:"w-12 h-12 text-blue-400"}),i.jsx("h1",{className:"text-2xl font-bold text-white",children:"Herramienta de Escritorio"}),i.jsx("p",{className:"text-zinc-400 text-base leading-relaxed",children:"**Panorama Studio** es una aplicaciÃ³n de diseÃ±o profesional pensada para creadores de contenido que buscan la mÃ¡xima precisiÃ³n."})]})}):i.jsxs("div",{className:"w-full h-full select-none text-zinc-200",children:[i.jsx("header",{className:"fixed top-6 left-0 right-0 flex justify-center z-50 pointer-events-none",children:i.jsxs("div",{className:"glass-panel rounded-full px-2 py-2 flex items-center gap-4 pointer-events-auto",children:[i.jsxs("div",{className:"flex items-center gap-2 px-3 border-r border-white/10",children:[i.jsx("div",{className:"w-3 h-3 rounded-full bg-gradient-to-r from-pink-500 to-violet-500"}),i.jsx("span",{className:"font-bold text-sm",children:"Panorama"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:dn,className:"btn-icon",title:"Guardar Proyecto (.json)",children:i.jsx("i",{"data-lucide":"save",className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>r.current.click(),className:"btn-icon",title:"Cargar Proyecto (.json)",children:i.jsx("i",{"data-lucide":"folder-open",className:"w-4 h-4"})}),i.jsx("input",{ref:r,type:"file",accept:".json",onChange:Ra,className:"hidden"})]}),i.jsx("div",{className:"w-px h-4 bg-white/10"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-xs text-zinc-500",children:"SLIDES"}),i.jsx("select",{value:g,onChange:l=>b(Number(l.target.value)),className:"bg-zinc-800 rounded px-2 py-1 text-xs font-bold outline-none cursor-pointer",children:[2,3,4,5,6,7,8,9,10].map(l=>i.jsx("option",{value:l,children:l},l))})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>K(!A),className:`btn-icon ${A?"active":""}`,title:"GuÃ­a Central Horizontal",children:i.jsx("i",{"data-lucide":"rows",className:"w-4 h-4"})}),i.jsx("button",{onClick:Ka,className:"btn-icon",title:"Vista Previa Instagram",children:i.jsx("i",{"data-lucide":"eye",className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>sn(!0),className:"btn-icon",title:"Asistente de RedacciÃ³n (IA)",children:i.jsx("i",{"data-lucide":"sparkles",className:"w-4 h-4 text-blue-400"})}),i.jsx("button",{onClick:()=>en(!0),className:"btn-icon",title:"Ayuda y CrÃ©ditos",children:i.jsx("i",{"data-lucide":"help-circle",className:"w-4 h-4"})})]}),i.jsxs("div",{className:"flex gap-1 border-l border-white/10 pl-2",children:[i.jsx("button",{onClick:()=>bt(-1),className:"btn-icon",children:i.jsx("i",{"data-lucide":"undo-2",className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>bt(1),className:"btn-icon",children:i.jsx("i",{"data-lucide":"redo-2",className:"w-4 h-4"})})]})]})}),i.jsxs("main",{ref:e,className:`viewport-container ${on?"is-panning":""} ${X?"drag-active":""}`,onDragOver:Fa,onDragLeave:za,onDrop:La,onPointerDown:l=>{(Ca||l.button===1||l.button===2||l.target===e.current)&&(l.preventDefault(),ln(!0),rs.current={x:l.clientX-H.x,y:l.clientY-H.y})},onPointerMove:l=>{on&&U(o=>({...o,x:l.clientX-rs.current.x,y:l.clientY-rs.current.y}))},onPointerUp:()=>ln(!1),onWheel:l=>{l.ctrlKey&&(l.preventDefault(),as(l.deltaY>0?.9:1.1))},onContextMenu:l=>l.preventDefault(),children:[X&&i.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-50",children:i.jsx("div",{className:"bg-blue-600 text-white px-6 py-3 rounded-full font-bold text-xl shadow-xl animate-bounce",children:"Suelta la imagen aquÃ­"})}),i.jsxs("div",{style:{transform:`translate(${H.x}px, ${H.y}px) scale(${H.zoom})`,transformOrigin:"0 0",width:me,height:V,position:"absolute",boxShadow:"0 0 50px rgba(0,0,0,0.5)"},children:[i.jsx("canvas",{ref:n}),i.jsx("div",{className:"absolute top-full left-0 w-full flex mt-4 pointer-events-none",children:_.map((l,o)=>i.jsx("div",{style:{width:G,height:50,left:o*G,position:"absolute"},className:"flex justify-center items-start pointer-events-auto",children:i.jsxs("button",{onClick:h=>{h.stopPropagation(),ni(o)},className:`
                    flex items-center gap-2 px-4 py-2 rounded-full backdrop-blur-md border shadow-lg transition-all transform hover:scale-110
                    ${l?"bg-red-500/90 border-red-400 text-white":"bg-zinc-800/80 border-white/10 text-zinc-400 hover:text-white hover:bg-zinc-700"}
                  `,title:l?"Desbloquear Slide":"Bloquear Slide",children:[i.jsx("i",{"data-lucide":l?"lock":"unlock",className:"w-5 h-5"}),i.jsx("span",{className:"text-sm font-bold uppercase tracking-wider",children:l?"Bloqueado":`Slide ${o+1}`})]})},o))})]})]}),i.jsxs("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-40 flex flex-col items-center gap-2",children:[gt&&i.jsx("div",{className:"glass-panel p-2 rounded-xl flex gap-2 mb-2 animate-in slide-in-from-bottom-2 fade-in duration-200",children:oi.map(l=>i.jsxs("button",{onClick:()=>si(l.id),className:"flex flex-col items-center gap-1 p-2 hover:bg-white/10 rounded-lg transition w-20",children:[l.icon,i.jsx("span",{className:"text-[10px] text-zinc-400 font-bold",children:l.label})]},l.id))}),i.jsxs("div",{className:"glass-panel p-2 rounded-2xl flex items-center gap-2",children:[i.jsx("button",{onClick:Za,className:"btn-icon",title:"Texto",children:i.jsx("i",{"data-lucide":"type",className:"w-6 h-6"})}),i.jsx("button",{onClick:()=>tn(!gt),className:`btn-icon ${gt?"active":""}`,title:"Plantillas / Marcos",children:i.jsx("i",{"data-lucide":"layout-template",className:"w-6 h-6"})}),i.jsx("button",{onClick:ei,className:"btn-icon",title:"Forma",children:i.jsx("i",{"data-lucide":"square",className:"w-6 h-6"})}),i.jsxs("div",{className:"relative",children:[i.jsx("button",{onClick:()=>t.current.click(),className:"btn-icon",title:"Imagen",children:i.jsx("i",{"data-lucide":"image",className:"w-6 h-6"})}),i.jsx("input",{ref:t,type:"file",accept:"image/*",onChange:Ta,className:"hidden"})]}),i.jsx("div",{className:"w-px h-8 bg-white/10 mx-1"}),i.jsx("button",{onClick:()=>yt(),className:"btn-icon",children:i.jsx("i",{"data-lucide":"maximize",className:"w-5 h-5"})}),i.jsx("button",{onClick:()=>as(.8),className:"btn-icon",children:i.jsx("i",{"data-lucide":"minus",className:"w-5 h-5"})}),i.jsx("button",{onClick:()=>as(1.2),className:"btn-icon",children:i.jsx("i",{"data-lucide":"plus",className:"w-5 h-5"})})]})]}),I&&!Xe&&!Ye&&!Ge&&!Ke&&i.jsx(wo,{position:_e,selected:I,selProps:E,filterValues:L,colors:qn,shapeFileInputRef:s,onStartDrag:Ua,onDuplicate:hn,onDelete:fn,onPropChange:Ha,onAlign:Xa,onRotate:Wa,onFlip:qa,onFillSlide:Ja,onMaskToSlide:Ga,onToggleShapeEdit:Ba,onShapeColorChange:Qa,onTriggerShapeInput:()=>s.current.click(),onShapeFillInput:Da,onLayerAction:ti,onOpacityChange:Pa,onOpacityCommit:$a,onFilterChange:Ma}),i.jsx(yo,{isOpen:Xe,textState:fe,setTextState:ns,onClose:()=>Je(!1),onSave:Va,fonts:jo,colors:qn}),i.jsx(_o,{isOpen:Ye,onClose:()=>nn(!1),previewImg:Na,slideIndex:Aa,totalSlides:g,onNavigate:Ya,onExport:Ia,isExporting:ka}),Ke&&i.jsx(bo,{onClose:()=>sn(!1)}),Ge&&i.jsx(xo,{onClose:()=>en(!1)})]})};ai.createRoot(document.getElementById("root")).render(i.jsx(Un.StrictMode,{children:i.jsx(No,{})}));
